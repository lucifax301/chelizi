var app=angular.module("app",["ngFilter","ngSelects"]);app.controller("Bonus",["$scope","$rootScope","$filter","Selects",function(t,a,e,i){function s(a){var e={url:config.basePath+"vip/balance-batch",data:{pageNo:a,pageSize:parseInt(t.pageSize),startTime:t.startTime,endTime:t.endTime,vstate:t.vstate,utype:t.utype}};return e}t.defaultPage=location.hash.substring(2)||1,t.pageSize=10,t.startTime="",t.endTime="",t.vstate="",t.data={pages:10,total:100,pageSize:10,pageNo:1,dataList:[{id:201,createTime:"2015-12-12 12:13",bonusName:"案例",bonusNum:5,bonusMoney:2120,status:1,creator:"admin",award:"李四",awardTime:"2015-12-12 12:13"},{id:201,createTime:"2015-12-12 12:13",bonusName:"案例",bonusNum:5,bonusMoney:2120,status:2,creator:"admin",award:"李四",awardTime:"2015-12-12 12:13"},{id:201,createTime:"2015-12-12 12:13",bonusName:"案例",bonusNum:5,bonusMoney:2120,status:3,creator:"admin",award:"李四",awardTime:"2015-12-12 12:13"}]},t.datas=t.data.dataList,i.selects({datas:t.datas,whichId:"rrid"}),t.getDataList=function(){var a=s(t.defaultPage);$.AJAX({type:"get",url:a.url,data:a.data,success:function(a){var e=getListData(a);t.total=e.total,t.datas=e.dataList,i.selects({datas:t.datas,whichId:"rrid"}),t.$apply(),new Page({parent:$("#copot-page"),vstate:t.vstate,nowPage:t.defaultPage,pageSize:t.pageSize,totalCount:e.total})}})},t.getDataList(),window.onhashchange=function(){win.showLoading(),t.defaultPage=location.hash.substring(2)||1,t.getDataList()},t.getDataForTime=function(a,i){switch($(a.target).addClass("active").siblings().removeClass("active"),i){case"all":t.startTime=t.endTime="";break;case"0":t.startTime=e("date")((new Date).getTime()-6048e5,"yyyy-MM-dd HH:mm:ss"),t.endTime=e("date")((new Date).getTime(),"yyyy-MM-dd HH:mm:ss");break;case"1":t.startTime=e("date")((new Date).getTime()-1296e6,"yyyy-MM-dd HH:mm:ss"),t.endTime=e("date")((new Date).getTime(),"yyyy-MM-dd HH:mm:ss")}t.defaultPage=1,win.showLoading(),t.getDataList()},$("#reservation").daterangepicker({format:"YYYY-MM-DD HH:mm:ss"},function(a,i,s){t.startTime=t.endTime="",t.startTime=e("date")(a.toISOString(),"yyyy-MM-dd HH:mm:ss"),t.endTime=e("date")(i.toISOString(),"yyyy-MM-dd HH:mm:ss"),t.defaultPage=1,win.showLoading(),t.getDataList(),t.$apply()}),t.getDataForVstate=function(a,e){$(a.target).addClass("active").siblings().removeClass("active"),win.showLoading(),t.defaultPage=1,t.vstate=e,t.getDataList()},t.getDataForUtype=function(a,e){$(a.target).addClass("active").siblings().removeClass("active"),win.showLoading(),t.defaultPage=1,t.utype=e,t.getDataList()},t.getDataForPage=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},t.bonusDataExport=function(){dataExportForIframe({getSearchs:s(t.defaultPage).data,total:t.total,url:"vip/export-balance"})},t.setVpass=function(){if(!a.idList.length)return Layer.alert({width:300,height:150,type:"msg",title:"您尚未选择变更！",header:"审核大客户"}),!1;for(var e=getDataForKey({datas:t.datas,id:"rrid",idList:a.idList}),i=0;i<e.length;i++)if(1==e[i].vstate)return Layer.alert({width:300,height:150,type:"msg",title:"您不能审核已通过的变更！",header:"审核变更"}),!1;Layer.confirm({width:300,height:160,title:"确认审核通过吗？",header:"审核通过"},function(){$.AJAX({url:config.basePath+"vip/pass-balance",data:{rrids:a.idList.toString()},success:function(){a.idList=[],Layer.miss({width:250,height:90,title:"审核成功",closeMask:!0}),t.getDataList()}})})},t.setVfail=function(){if(!a.idList.length)return Layer.alert({width:300,height:150,type:"msg",title:"您尚未选择变更！",header:"审核变更"}),!1;for(var e=getDataForKey({datas:t.datas,id:"rrid",idList:a.idList}),i=0;i<e.length;i++)if(0!=e[i].vstate)return Layer.alert({width:300,height:150,type:"msg",title:"您只能选择待审的学员！",header:"审核大客户"}),!1;Layer.confirm({width:300,height:160,title:"确认审核不通过吗？",header:"审核不通过"},function(){$.AJAX({url:config.basePath+"vip/refuse-balance",data:{rrids:a.idList.toString()},success:function(){a.idList=[],Layer.miss({width:250,height:90,title:"审核成功",closeMask:!0}),t.getDataList()}})})}}]);