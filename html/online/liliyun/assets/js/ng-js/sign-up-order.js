var app=angular.module("app",["ngFilter"]);app.controller("Order",["$scope","$filter",function(e,t){function a(t){var a={url:config.basePath+"enrollOrder/query",data:{pageNo:t,pageSize:parseInt(e.pageSize),startTime:e.startTime,endTime:e.endTime,cityId:e.cityId,payState:e.payState,dltype:e.dltype,orderState:e.orderState,orderby:e.orderby,sort:e.sort}};return a.data[e.searchType]=e.search,a}e.defaultPage=location.hash.substring(2)||1,e.pageSize=10,e.startTime="",e.endTime="",e.cityId="",e.payState="",e.dltype="",e.searchType="orderId",e.orderState="",e.search="",e.orderby="",e.sort="",e.getDataList=function(){var t=a(e.defaultPage);$.AJAX({type:"get",url:t.url,data:t.data,success:function(t){var a=getListData(t);e.datas=a.dataList,e.$apply(),topLongText(),new Page({parent:$("#copot-page"),nowPage:e.defaultPage,pageSize:e.pageSize,totalCount:a.total})}})},e.getDataList(),window.onhashchange=function(){win.showLoading(),e.defaultPage=location.hash.substring(2)||1,e.getDataList()},e.getDataForTime=function(a,i){switch($(a.target).addClass("active").siblings().removeClass("active"),i){case"all":e.startTime=e.endTime="";break;case"0":e.startTime=t("date")((new Date).getTime()-6048e5,"yyyy-MM-dd"),e.endTime=t("date")((new Date).getTime(),"yyyy-MM-dd");break;case"1":e.startTime=t("date")((new Date).getTime()-1296e6,"yyyy-MM-dd"),e.endTime=t("date")((new Date).getTime(),"yyyy-MM-dd")}e.defaultPage=1,win.showLoading(),e.getDataList()},$("#reservation").daterangepicker({format:"YYYY/MM/DD"},function(a,i,s){e.startTime=e.endTime="",e.startTime=t("date")(a.toISOString(),"yyyy-MM-dd"),e.endTime=t("date")(i.toISOString(),"yyyy-MM-dd"),win.showLoading(),e.defaultPage=1,e.getDataList(),e.$apply()}),e.getDataForCity=function(t,a){$(t.target).addClass("active").siblings().removeClass("active"),win.showLoading(),e.defaultPage=1,e.cityId=a,e.getDataList()},e.getDataForPayment=function(t,a){$(t.target).addClass("active").siblings().removeClass("active"),win.showLoading(),e.defaultPage=1,e.payState=a,e.getDataList()},e.getDataForIsdel=function(t,a){$(t.target).addClass("active").siblings().removeClass("active"),win.showLoading(),e.defaultPage=1,e.orderState=a,e.getDataList()},e.getDataForDriveType=function(t,a){$(t.target).addClass("active").siblings().removeClass("active"),win.showLoading(),e.defaultPage=1,e.dltype=a,e.getDataList()},e.getDataForPage=function(){win.showLoading(),e.defaultPage=1,e.getDataList()},e.getDataForSearch=function(){win.showLoading(),e.defaultPage=1,e.getDataList()},e.orderDataExport=function(){""==e.startTime&&(e.startTime=new Date(new Date-6048e5).date("y-m-d")),""==e.endTime&&(e.endTime=(new Date).date("y-m-d")),console.log(e.startTime+"~"+e.endTime),dataExportForIframe({getSearchs:a(e.defaultPage).data,total:e.total,url:"enrollOrder/export-excel"})},$(".orderby").click(function(){e.orderby=$(this).attr("data-order-by"),$(this).hasClass("sortbydesc")?(e.sort="asc",$(this).removeClass("sortbydesc").addClass("sortbyasc")):(e.sort="desc",$(this).removeClass("sortbyasc").addClass("sortbydesc")),e.getDataList()})}]);