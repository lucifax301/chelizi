var app=angular.module("app",["ngFilter","ngSelects"]);app.controller("bigClient",["$scope","$rootScope","$filter","Selects",function(t,e,a,i){function n(e){var a={url:config.basePath+"vip/company-batch",data:{pageNo:e,pageSize:parseInt(t.pageSize)}};return a.data[t.searchType]=t.search,a}t.defaultPage=location.hash.substring(2)||1,t.pageSize=10,t.searchType="company",t.search="",t.getDataList=function(){var e=n(t.defaultPage);$.AJAX({type:"get",url:e.url,data:e.data,success:function(e){var a=getListData(e);t.datas=a.dataList,i.selects({datas:t.datas,whichId:"coid",num:""}),t.$apply(),new Page({parent:$("#copot-page"),nowPage:t.defaultPage,pageSize:t.pageSize,totalCount:a.total})}})},t.getDataList(),$.AJAX({type:"get",url:config.basePath+"school/queryCity",data:{rlevel:2,pid:""},success:function(e){t.citys=JSON.parse(e.result.pageData)}}),$.AJAX({type:"get",url:config.basePath+"school/queryCity",data:{rlevel:2,pid:""},success:function(e){t.promotion=JSON.parse(e.result.pageData)}}),window.onhashchange=function(){win.showLoading(),t.defaultPage=location.hash.substring(2)||1,t.getDataList()},t.getDataForPage=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},t.getDataForSearch=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},$("#search_type").change(function(){$("#search_placeholder").attr("placeholder","输入"+$(this).children("option:selected").text()+"查询")}),t.addClient=function(){t.item={},$(".client-alert").fadeIn("fast"),$("#client-alert").css("marginTop",parseInt(($(win).height()-$("#client-alert").height()-100)/2)+"px"),$(".closeAlert").click(function(){$(this).parents("div.client-alert").fadeOut("fast")})},t.editClient=function(e){t.item=e,$(".client-alert").fadeIn("fast"),$("#client-alert").css("marginTop",parseInt(($(win).height()-$("#client-alert").height()-100)/2)+"px"),$(".closeAlert").click(function(){$(this).parents("div.client-alert").fadeOut("fast")})},t.downLoadData=function(){Layer.confirm({width:300,height:160,title:"本次导出最多支持1000条数据",header:"数据导出"},function(){dataExportForIframe({getSearchs:n(t.defaultPage).data,total:t.total,url:"/vip/export-company"})})},t.active=function(){var a=getDataForKey({datas:t.datas,id:"coid",idList:e.idList});if(!a.length)return Layer.alert({width:300,height:150,type:"msg",title:"请选择操作大客戶！"}),!1;for(var i=0;i<a.length;i++)if(0!=a[i].active)return Layer.alert({width:300,height:150,type:"msg",title:"您只能选择未激活的大客户！"}),!1;Layer.confirm({width:380,height:160,title:"您确认把所选大客户置为[激活启用]？",header:"大客户操作"},function(){$.AJAX({url:config.basePath+"vip/active-company",type:"POST",data:{coids:e.idList.toString()},success:function(a){e.idList=[],Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList()}})})},t.inactive=function(){var a=getDataForKey({datas:t.datas,id:"coid",idList:e.idList});if(!a.length)return Layer.alert({width:300,height:150,type:"msg",title:"请选择操作大客戶！"}),!1;for(var i=0;i<a.length;i++)if(1!=a[i].active)return Layer.alert({width:300,height:150,type:"msg",title:"您只能选择已激活的大客户！"}),!1;Layer.confirm({width:380,height:160,title:"您确认把所选大客户置为[停用状态]？",header:"大客户操作"},function(){$.AJAX({url:config.basePath+"vip/inactive-company",type:"POST",data:{coids:e.idList.toString()},success:function(a){e.idList=[],Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList()}})})},t.submitItemInfo=function(){if(!t.item.company)return Layer.alert({width:300,height:150,type:"msg",title:"请填写大客户名称"}),!1;if(!t.item.shorter)return Layer.alert({width:300,height:150,type:"msg",title:"请填写标识简称"}),!1;if(!t.item.cityId)return Layer.alert({width:300,height:150,type:"msg",title:"请选择所在城市"}),!1;if(!t.item.manger)return Layer.alert({width:300,height:150,type:"msg",title:"请填写客户经理"}),!1;if(!t.item.mobile||t.item.mobile.length<11)return Layer.alert({width:300,height:150,type:"msg",title:"请检查电话号码"}),!1;var e=void 0==t.item.coid?"vip/add-company":"vip/modify-company",a={coid:t.item.coid,company:t.item.company,shorter:t.item.shorter,cityId:t.item.cityId,manger:t.item.manger,mobile:t.item.mobile,city:$("#searchCity").find("option:checked").attr("dataName")};t.item.coid||(a.active=0),Layer.confirm({width:320,height:160,title:"确认提交当前的大客户信息？",header:"提示"},function(){$.AJAX({type:"POST",url:config.basePath+e,data:a,success:function(e){console.log(a),Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),$("#client-alert").parents("div.client-alert").fadeOut("fast"),t.getDataList()}})})}}]);