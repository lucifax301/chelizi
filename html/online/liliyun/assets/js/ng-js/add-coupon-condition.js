var app=angular.module("app",[]);app.controller("CouponCondition",["$scope",function(e){$.AJAX({type:"get",url:config.basePath+"school/queryCity",data:{rlevel:2,pid:""},success:function(a){e.citys=JSON.parse(a.result.pageData),e.$apply()}}),$("#reservStart").daterangepicker({format:"YYYY-MM-DD",singleDatePicker:!0,autoclose:!0,timePicker:!0,timePicker24Hour:!0,timePickerSeconds:!0,autoApply:!0,locale:{format:"YYYY-MM-DD HH:mm:ss"}}),$("#reservEnd").daterangepicker({format:"YYYY-MM-DD",singleDatePicker:!0,autoclose:!0,timePicker:!0,timePicker24Hour:!0,timePickerSeconds:!0,autoApply:!0,locale:{format:"YYYY-MM-DD HH:mm:ss"}}),e.zdkmARR=[{id:"zdkmBox1",value:"1|11",info:"科目二基础训练"},{id:"zdkmBox2",value:"6|16",info:"科目二应试训练"},{id:"zdkmBox3",value:"2|12",info:"科目二考场模拟"},{id:"zdkmBox4",value:"3|13",info:"科目三基础训练"},{id:"zdkmBox5",value:"7|17",info:"科目三应试训练"},{id:"zdkmBox6",value:"4|14",info:"科目三考场模拟"},{id:"zdkmBox7",value:"101",info:"体验课程"},{id:"zdkmBox8",value:"5|15",info:"陪驾"}],e.editData={},e.editData.getNum=1,e.zNumReduce=function(a){e.editData.getNum<=1?"":e.editData.getNum--},e.zNumAdd=function(a){e.editData.getNum++},e.setType=function(a,r){e.editData.type=r,$(".table-coupon-condi-add .shade-color").slideDown(),$(a.target).parent("th").siblings("td").find(".shade-color").slideUp("fast")},e.submitEditMsg=function(){if(clearTimeout("errorMsg"),e.confirmSelVals="",e.confirmLayerH=140,0!=e.editData.type&&1!=e.editData.type&&2!=e.editData.type&&3!=e.editData.type)return $(".table-coupon-condi-add th").css("border-color","red"),$(".error-xlcs").html("请选择条件类型").slideDown("fast"),errorMsg=setTimeout(function(){$(".table-coupon-condi-add th").css("border-color","#ddd"),$(".error-xlcs").empty().slideUp("fast")},1500),!1;switch(e.editData.type){case 2:if(e.confirmHead="指定科目",e.ZDKMselVals=[],$('.zdkm-wrap input[name="zdkmBox"]:checked').each(function(){""!=$(this).val()&&e.ZDKMselVals.push($(this).val()),$(this).attr("confirmTxt")&&(e.confirmSelVals+=$(this).attr("confirmTxt")+"<br>",e.confirmLayerH+=22)}),e.editData.param1=e.ZDKMselVals.join("|"),e.editData.param2="-",!e.editData.param1)return clearTimeout("errorMsg"),$(".zdkm-wrap .shade-wrap").css("border","1px solid red"),$(".error-zdkm").css("padding-left","150px").html("请勾选指定科目").slideDown("fast"),errorMsg=setTimeout(function(){$(".zdkm-wrap .shade-wrap").css("border","none"),$(".error-zdkm").empty().css({display:"none",padding:"0"})},1500),!1;break;case 1:if(e.confirmHead="指定区域",e.ZDQYselVals=[],$('.zdqy-wrap input[name="zdqyBox"]:checked').each(function(){""!=$(this).val()&&e.ZDQYselVals.push($(this).val()),$(this).attr("confirmTxt")&&(e.confirmSelVals+=$(this).attr("confirmTxt")+"<br>",e.confirmLayerH+=22)}),e.editData.param1=e.ZDQYselVals.join("|"),e.editData.param2="-",!e.editData.param1)return clearTimeout("errorMsg"),$(".zdqy-wrap .shade-wrap").css("border","1px solid red"),$(".error-zdqy").css("padding-left","150px").html("请勾选指定区域").slideDown("fast"),errorMsg=setTimeout(function(){$(".zdqy-wrap .shade-wrap").css("border","none"),$(".error-zdqy").empty().css({display:"none",padding:"0"})},1500),!1;break;case 0:if(e.confirmHead="指定时间",e.editData.param1=e.editData.reservStart,e.editData.param2=e.editData.reservEnd,!e.editData.param1||!e.editData.param2)return clearTimeout("errorMsg"),$(".zdsj-wrap .shade-wrap").css("border","1px solid red"),$(".error-zdsj").css("padding-left","150px").html("请设置起点终点时间").slideDown("fast"),errorMsg=setTimeout(function(){$(".zdsj-wrap .shade-wrap").css("border","none"),$(".error-zdsj").empty().css({display:"none",padding:"0"})},1500),!1;e.confirmLayerH=190,e.confirmSelVals="开始："+e.editData.param1+"<br>结束："+e.editData.param2;break;case 3:e.confirmHead="限领次数",e.editData.param1=e.editData.getNum,e.editData.param2="-",e.confirmSelVals=e.editData.param1,e.confirmLayerH=165}return e.editData.descri?void Layer.confirmTextAlert({width:350,height:e.confirmLayerH,title:e.confirmSelVals,header:e.confirmHead},function(){$.AJAX({url:config.basePath+"coupon/add-cond",data:{type:e.editData.type,param1:e.editData.param1,param2:e.editData.param2,descri:e.editData.descri},success:function(e){Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),setTimeout(function(){window.location.href="coupon-condition.html"},1e3)}})}):($(".error-tjsm").css("border-color","red"),$(".error-tjsm").html("请填写条件说明").slideDown("fast"),errorMsg=setTimeout(function(){$(".error-tjsm").css("border-color","#ddd"),$(".error-tjsm").empty().slideUp("fast")},1500),!1)}}]);