var app=angular.module("app",["ngFilter","ngSelects"]);app.controller("Notice",["$scope","$rootScope","$filter","Selects",function(t,e,a,i){function s(e){var a={url:config.basePath+"notice/getNotice",data:{pageNo:e,pageSize:parseInt(t.pageSize),type:t.type,userType:t.userType}};return a}function d(e){var a={title:t.editData.title,content:t.editData.content,extra:t.editData.extra,userId:t.editData.userId,type:t.editData.type,userType:t.editData.userType};return"edit"==t.editType&&angular.extend(a,{noticeId:t.editData.noticeId}),{url:config.basePath+e,data:a}}t.defaultPage=location.hash.substring(2)||1,t.pageSize=10,t.type=0,t.userType=0,t.data={pages:10,total:100,pageSize:10,pageNo:1,dataList:[{noticeId:2,title:"通知",content:"通知内容",time:"2016-08-03 16:54:28",extra:"http://baidu.com",userId:47707364}]},t.datas=t.data.dataList,t.getDataList=function(){var e=s(t.defaultPage);$.AJAX({type:"post",url:e.url,data:e.data,success:function(e){var a=getListData(e);t.total=a.total,t.datas=a.dataList,i.selects({datas:t.datas,whichId:"noticeId",num:""}),t.$apply(),new Page({parent:$("#copot-page"),nowPage:t.defaultPage,pageSize:t.pageSize,totalCount:t.total})}})},t.getDataList(),window.onhashchange=function(){win.showLoading(),t.defaultPage=location.hash.substring(2)||1,t.getDataList()},t.getTypeStatus=function(e,a){$(e.target).addClass("active").siblings().removeClass("active"),win.showLoading(),t.defaultPage=1,t.type=a,t.getDataList()},t.getUserTypeStatus=function(e,a){$(e.target).addClass("active").siblings().removeClass("active"),win.showLoading(),t.defaultPage=1,t.userType=a,t.getDataList()},t.getDataForPage=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},t.coachDataExport=function(){dataExportForIframe({getSearchs:s(t.defaultPage).data,total:t.total,url:"coach/export-excel"})},t.changeUserId=function(){var e=$("#userTypeSel").val(),a=$("#userTypeSel").find("option:selected").text();"全体用户"==a||"全体教练"==a||"全体学员"==a?$("#user").hide():"指定教练"==a?($("#userText").html("教练ID"),$("#user").show()):"指定学员"==a?($("#userText").html("学员ID"),$("#user").show()):"3"==e||"4"==e?($("#userText").html("驾校ID"),$("#user").show()):"5"==e||"6"==e?($("#userText").html("城市ID"),$("#user").show()):"7"==e&&$("#user").hide(),t.getDataList()},t.noticeEditLoad=function(){$(".closeAlert").click(function(){$(this).parents("div.edit-notice").fadeOut("fast")})},t.editData={},t.editType="add",t.noticeEdit=function(e,a){$(".edit-notice").fadeIn("fast"),$("#edit-notice").css("marginTop",parseInt(($(win).height()-$("#edit-notice").height()-100)/2)+"px"),"edit"==e?(t.editData=a,t.editType="edit"):(t.editData={},t.editType="add")},t.submitEditMsg=function(e){var a=d("add"==t.editType?"notice/add":"notice/update");if(!t.editData.title||!regCombination("*").test(t.editData.title))return Layer.alert({width:300,height:150,type:"msg",title:"请填写通知标题"}),!1;if(!t.editData.content)return Layer.alert({width:300,height:150,type:"msg",title:"请填写内容"}),!1;if(!t.editData.type&&"0"!=t.editData.type)return Layer.alert({width:300,height:150,type:"msg",title:"请选择公告类别"}),!1;if(!t.editData.userType&&"0"!=t.editData.userType)return Layer.alert({width:300,height:150,type:"msg",title:"请选择通知对象"}),!1;var i=$("#userTypeSel").find("option:selected").text();return"指定教练"!=i&&"指定学员"!=i&&"驾校教练"!=i&&"驾校学员"!=i&&"城市教练"!=i&&"城市学员"!=i||t.editData.userId?void $.AJAX({url:a.url,data:a.data,success:function(a){$(e.target).parents("div.edit-notice").fadeOut("fast"),Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList()}}):(Layer.alert({width:300,height:150,type:"msg",title:"请填通知ID"}),!1)},t.closeAlert=function(){t.getDataList()}}]);