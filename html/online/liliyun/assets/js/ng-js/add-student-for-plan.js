var app=angular.module("app",["ngFilter","ngSelects"]);app.controller("AddStuForPlan",["$scope","$rootScope","$filter","Selects",function(t,a,e,i){function s(a){var e={url:config.basePath+"vip/custom-batch",data:{pageNo:a,pageSize:parseInt(t.pageSize),vipBig:t.vipBig,coid:t.coid,isDel:0,rcid:t.rcid}};return e.data[t.searchType]=t.search,e}t.defaultPage=location.hash.substring(2)||1,t.pageSize=10,t.coid="",t.vipBig="",t.search="",t.searchType="mobile",t.rcid=getQueryString("rcid"),$.AJAX({type:"get",url:config.basePath+"vip/plan-batch",data:{rcid:t.rcid,pageNo:1,pageSize:10},success:function(a){t.rcinfo=JSON.parse(a.result.pageData).dataList[0]}}),$.AJAX({type:"get",url:config.basePath+"vip/company-batch",data:{pageNo:t.defaultPage,pageSize:100},success:function(a){var e=getListData(a);t.companys=e.dataList,t.$apply()}}),i.selects({datas:t.datas,whichId:"studentId"}),t.getDataList=function(){var a=s(t.defaultPage);$.AJAX({type:"get",url:a.url,data:a.data,success:function(a){var e=getListData(a);t.total=e.total,t.datas=e.dataList,i.selects({datas:t.datas,whichId:"studentId"}),t.$apply(),new Page({parent:$("#copot-page"),nowPage:t.defaultPage,pageSize:t.pageSize,totalCount:e.total})}})},t.getDataList(),window.onhashchange=function(){win.showLoading(),t.defaultPage=location.hash.substring(2)||1,t.getDataList()},t.getDataForStuType=function(a,e){$(a.target).addClass("active").siblings().removeClass("active"),win.showLoading(),t.vipBig=e,t.defaultPage=1,t.getDataList()},t.getDataForCompany=function(){win.showLoading(),t.defaultPage=1,t.vipBig="true",$("#select-student li").last().addClass("active").siblings().removeClass("active"),t.getDataList()},t.getDataForPage=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},t.getDataForSearch=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},t.submitStuForPlan=function(){if(!a.idList.length)return Layer.alert({width:300,height:150,type:"msg",title:"请选择需要添加的学员！"}),!1;for(var e=getDataForKey({datas:t.datas,id:"studentId",idList:a.idList}),i=getKeyArrFromData(e,"coid"),s=0;s<i.length;s++)i[s]||(i[s]=4);Layer.confirm({width:300,height:160,title:"确认添加至方案吗？",header:"关闭订单"},function(){$.AJAX({url:config.basePath+"vip/new-studentBatch",data:{studentIds:a.idList.toString(),mobiles:getKeyArrFromData(e,"phoneNum").toString(),coids:i.toString()}})})}}]);