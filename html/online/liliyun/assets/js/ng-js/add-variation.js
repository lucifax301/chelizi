var app=angular.module("app",[]);app.controller("variation",["$scope","$compile",function(t,a){t.phoneNum="",t.utype="1",t.stuSearch=function(a){return regCombination("*").test(a)?(t.isDatas=!0,void $.AJAX({url:config.basePath+"student/findStudentOrCoach",type:"get",data:{phoneNum:t.phoneNum,utype:t.utype},success:function(a){return t.datas=JSON.parse(a.result.pageData).dataList[0],void 0==t.datas?void t.$apply():(t.datas.name=t.datas.name?t.datas.name:"喱喱同学",t.searchSex="无",console.log(t.datas.sex),0==t.datas.sex&&(t.searchSex="女"),1==t.datas.sex&&(t.searchSex="男"),t.datas.idNumber=t.datas.idNumber?t.datas.idNumber:"无",void t.$apply())}})):(Layer.alert({type:"msg",title:"请输入手机号!"}),!1)},t.confirmVariation=function(){if(!t.datas)return Layer.alert({width:430,height:175,type:"msg",title:"请选择变更学员"}),!1;if(isNaN(t.recharge)||!t.recharge)return Layer.alert({width:430,height:175,type:"msg",title:"请检查输入金额"}),!1;if(!t.rcname)return Layer.alert({width:430,height:175,type:"msg",title:"请输入变更理由"}),!1;var a=t.datas.name?t.datas.name:"喱喱同学",e=t.datas.phoneNum,d="无";0==parseInt(t.datas.sex)&&(d="女"),1==parseInt(t.datas.sex)&&(d="男");var s=t.datas.idNumber?t.datas.idNumber:"无",r='<div class="custom-msg-but"><p class="z-mb20 z-t-c z-font16">是否确认给此'+(1==t.utype?"学员":"教练")+'余额变更记录</p><table class="table table-bordered table-striped"><tr><td>姓名</td><td>性别</td><td>电话</td><td>身份证号</td></tr><tr><td>'+a+"</td><td>"+d+"</td><td>"+e+"</td><td>"+s+'</td></tr></table><div><button type="button" onclick=Layer.closeNowLayer("customHtmlMask"); class="btn btn-sm btn-default">取消</button><button type="button" id="submitChange" class="btn btn-sm btn-primary">确定</button></div></div>';Layer.customHtml({header:"新增变更记录",width:650,height:250,html:r}),$("#submitChange").bind("click",function(){$(this).unbind("click");var a=t.datas.studentId;"2"==t.utype&&(a=t.datas.coachId),$.AJAX({url:config.basePath+"vip/add-record",data:{studentId:a,name:t.datas.name,recharge:100*t.recharge,rcid:0,rcname:t.rcname,vstate:0,utype:t.utype},success:function(t){$("div.customHtmlMask").fadeOut("slow"),Layer.confirm({width:300,height:160,title:"变更成功，要返回吗？",header:"返回变更列表"},function(){window.location.href="bonus-balance.html"})}})})}}]);