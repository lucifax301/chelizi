var app=angular.module("app",["ngFilter","ngSelects"]);app.controller("RechargePrivi",["$scope","$rootScope","$filter","Selects",function(a,t,e,s){function i(t){var e={url:config.basePath+"vip/plan-batch",data:{pageNo:t,pageSize:parseInt(a.pageSize),name:a.name}};return e.data[a.searchType]=a.search,e}a.defaultPage=location.hash.substring(2)||1,a.pageSize=10,a.searchType="rcname",a.search="",a.getDataList=function(){var t=i(a.defaultPage);return $.AJAX({type:"get",url:t.url,data:t.data,success:function(t){var e=getListData(t);a.total=e.total,a.datas=e.dataList,s.selects({datas:a.datas,whichId:"rcid"}),a.$apply(),topLongText(),new Page({parent:$("#copot-page"),nowPage:a.defaultPage,pageSize:a.pageSize,totalCount:e.total})}}),t.data[a.searchType]=a.search,t},a.getDataList(),s.selects({datas:a.datas,whichId:"rcid"}),window.onhashchange=function(){win.showLoading(),a.defaultPage=location.hash.substring(2)||1,a.getDataList()},a.getDataForSearch=function(){win.showLoading(),a.defaultPage=1,a.getDataList()},a.getDataForPage=function(){win.showLoading(),a.defaultPage=1,a.getDataList()},$("#search_type").change(function(){$("#search_placeholder").attr("placeholder","输入"+$(this).children("option:selected").text()+"查询"),"rcid"==$("#search_type").val()?$("#search_placeholder").attr("type","number"):$("#search_placeholder").attr("type","text")}),a.activeAction=function(e){var s={msgWords:"",msgUrl:"",msgCode:""};switch(e){case"cActive":s.msgWords="激活",s.msgUrl=config.basePath+"vip/active-plan",s.msgCode=0,s.msgWords2="停用";break;case"cCancle":s.msgWords="停发",s.msgUrl=config.basePath+"vip/inactive-plan",s.msgCode=1,s.msgWords2="激活"}if(!t.idList.length)return Layer.alert({width:300,height:150,type:"msg",title:"请选择需要"+s.msgWords+"的方案！"}),!1;for(var i=getDataForKey({datas:a.datas,id:"rcid",idList:t.idList}),r=!0,o="",c=0;c<i.length;c++)if(i[c].active!=s.msgCode){o="您只能选择"+s.msgWords2+"的方案，<br>请重新选择！",r=!1;break}return r?void Layer.confirm({width:300,height:160,title:"确认"+s.msgWords+"选中方案吗？",header:s.msgWords+"方案"},function(){$.AJAX({url:s.msgUrl,data:{ids:t.idList.toString()},success:function(e){t.idList=[],Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),a.getDataList()}})}):(Layer.alert({width:330,height:175,type:"msg",title:o}),!1)}}]);