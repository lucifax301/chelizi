var app=angular.module("app",["ngFilter","ngSelects"]);app.controller("Order",["$scope","$rootScope","$filter","Selects",function(e,t,a,d){function i(t){var a={url:config.basePath+"order/queryRefund",data:{pageNo:t,pageSize:parseInt(e.pageSize),startTime:e.startTime,endTime:e.endTime,status:e.refundState}};return a.data[e.searchType]=e.search,a}e.defaultPage=location.hash.substring(2)||1,e.pageSize=10,e.startTime="",e.endTime="",e.refundState="",e.searchType="orderId",e.search="",e.data={pages:10,total:100,pageSize:10,pageNo:1,dataList:[{orderId:"0121545wfewefwefwvrt0rg",studentId:25,studentName:"小张",coachId:1151,coachName:"张教练",payment:0},{orderId:"15616516egergerferferfer",studentId:26,studentName:"小张",coachId:1152,coachName:"张教练",payment:1},{orderId:"216sefewsfs516516eferfer",studentId:27,studentName:"小张",coachId:1153,coachName:"张教练",payment:0}]},e.datas=e.data.dataList,d.selects({datas:e.datas,whichId:"id"}),e.getDataList=function(){var t=i(e.defaultPage);$.AJAX({type:"get",url:t.url,data:t.data,success:function(t){var a=getListData(t);e.total=a.total,e.datas=a.dataList,d.selects({datas:e.datas,whichId:"id"}),e.$apply(),topLongText(),new Page({parent:$("#copot-page"),nowPage:e.defaultPage,pageSize:e.pageSize,totalCount:a.total})}})},e.getDataList(),window.onhashchange=function(){win.showLoading(),e.defaultPage=location.hash.substring(2)||1,e.getDataList()},e.getDataForTime=function(t,d){switch($(t.target).addClass("active").siblings().removeClass("active"),d){case"all":e.startTime=e.endTime="";break;case"0":e.startTime=a("date")((new Date).getTime()-6048e5,"yyyy-MM-dd"),e.endTime=a("date")((new Date).getTime(),"yyyy-MM-dd");break;case"1":e.startTime=a("date")((new Date).getTime()-1296e6,"yyyy-MM-dd"),e.endTime=a("date")((new Date).getTime(),"yyyy-MM-dd")}e.defaultPage=1,win.showLoading(),e.getDataList()},$("#reservation").daterangepicker({format:"YYYY/MM/DD"},function(t,d,i){e.startTime=e.endTime="",e.startTime=a("date")(t.toISOString(),"yyyy-MM-dd"),e.endTime=a("date")(d.toISOString(),"yyyy-MM-dd"),e.defaultPage=1,win.showLoading(),e.getDataList(),e.$apply()}),e.getRefundState=function(t,a){$(t.target).addClass("active").siblings().removeClass("active"),win.showLoading(),e.defaultPage=1,e.refundState=a,e.getDataList()},e.getDataForPage=function(){win.showLoading(),e.defaultPage=1,e.getDataList()},e.getDataForSearch=function(){win.showLoading(),e.defaultPage=1,e.getDataList()},e.refundSuccess=function(){for(var a=getDataForKey({datas:e.datas,id:"id",idList:t.idList}),d=[],i=0;i<a.length;i++){var s=a[i];d.push(s.orderId)}return e.orderIdList=d.toString(),t.idList.length?0!=s.status?(Layer.alert({width:340,height:150,type:"msg",title:"该操作只对'退款中'的订单有效！",header:"退款成功"}),!1):void Layer.confirm({width:300,height:160,title:"您确认所选订单已经线下退<br>款成功了吗？",header:"退款成功"},function(){$.AJAX({url:config.basePath+"order/subRefund",data:{orderIdList:e.orderIdList},success:function(t){Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),e.getDataList()}})}):(Layer.alert({width:300,height:150,type:"msg",title:"请选择'退款中'的订单！",header:"退款成功"}),!1)}}]);