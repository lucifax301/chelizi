var app=angular.module("app",["ngFilter","ngSelects"]);app.controller("WithdrawSchool",["$scope","$rootScope","$filter","Selects",function(t,e,a,i){function s(e){var a={url:config.basePath+"schoolDeposit/query",data:{pageNo:e,pageSize:parseInt(t.pageSize),startTime:t.startTime,endTime:t.endTime,status:t.status}};return a.data[t.searchType]=t.search,a}t.defaultPage=location.hash.substring(2)||1,t.pageSize=10,t.startTime="",t.endTime="",t.status="",t.cardName="",t.searchType="cardName",t.search="",t.data={pages:10,total:100,pageSize:10,pageNo:1,dataList:[{id:0,createTime:"2015-12-12",cardName:"wangwei",money:120,type:1,bankNo:"432544856644515",checkStatus:0},{id:1,createTime:"2015-12-12",cardName:"wangwei",money:120,type:2,bankNo:"432544856644515",checkStatus:1},{id:2,createTime:"2015-12-12",cardName:"wangwei",money:120,type:3,bankNo:"432544856644515",checkStatus:2},{id:3,createTime:"2015-12-12",cardName:"wangwei",money:120,type:3,bankNo:"432544856644515",checkStatus:3},{id:4,createTime:"2015-12-12",cardName:"wangwei",money:120,type:4,bankNo:"432544856644515",checkStatus:4},{id:5,createTime:"2015-12-12",cardName:"wangwei",money:120,type:5,bankNo:"432544856644515",checkStatus:5}]},t.datas=t.data.dataList,i.selects({datas:t.datas,whichId:"id",trem:{check:"checkStatus",list:[0,3,4,5]}}),t.getDataList=function(){var e=s(t.defaultPage);$.AJAX({type:"get",url:e.url,data:e.data,success:function(e){var a=getListData(e);t.datas=a.dataList,i.selects({datas:t.datas,whichId:"id",trem:{check:"checkStatus",list:[0,3,4,5]}}),t.$apply(),new Page({parent:$("#copot-page"),nowPage:t.defaultPage,pageSize:t.pageSize,totalCount:a.total})}})},t.getDataList(),window.onhashchange=function(){win.showLoading(),t.defaultPage=location.hash.substring(2)||1,t.getDataList()},t.getDataForTime=function(e,i){switch($(e.target).addClass("active").siblings().removeClass("active"),i){case"all":t.startTime=t.endTime="";break;case"0":t.startTime=a("date")((new Date).getTime()-6048e5,"yyyy-MM-dd"),t.endTime=a("date")((new Date).getTime(),"yyyy-MM-dd");break;case"1":t.startTime=a("date")((new Date).getTime()-1296e6,"yyyy-MM-dd"),t.endTime=a("date")((new Date).getTime(),"yyyy-MM-dd")}win.showLoading(),t.defaultPage=1,t.getDataList()},$("#reservation").daterangepicker({format:"YYYY/MM/DD"},function(e,i,s){t.startTime=t.endTime="",t.startTime=a("date")(e.toISOString(),"yyyy-MM-dd"),t.endTime=a("date")(i.toISOString(),"yyyy-MM-dd"),win.showLoading(),t.defaultPage=1,t.getDataList(),t.$apply()}),t.getDataForState=function(e,a){$(e.target).addClass("active").siblings().removeClass("active"),win.showLoading(),t.defaultPage=1,t.status=a,t.getDataList()},t.getDataForPage=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},t.getDataForSearch=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},t.finaConfirm=function(){return e.idList.length?isFinaConfirm({datas:t.datas,idList:e.idList,id:"id",check:"checkStatus",val:[1,2,3,4,5]})?(Layer.alert({width:300,height:150,type:"msg",title:"不能重复确认！"}),!1):void Layer.confirm({width:300,height:170,title:"已选择 <strong class='mainColor'>"+e.idList.length+"</strong> 条提现申请,是否<br>确认审核通过?",header:"财务确认"},function(){$.AJAX({url:config.basePath+"bankDeposit/financePass",data:{idList:e.idList.toString()},success:function(a){e.idList=[],Layer.miss({width:250,height:90,title:"提交成功",closeMask:!0}),t.getDataList()}})}):(Layer.alert({width:300,height:150,type:"msg",title:"请选择需要操作的数据！",header:"财务确认"}),!1)},t.RefusedToFinance=function(){return e.idList.length?isFinaConfirm({datas:t.datas,idList:e.idList,id:"id",check:"checkStatus",val:[1,2,3,4,5]})?(Layer.alert({width:300,height:150,type:"msg",title:"不能拒绝已确认的申请！"}),!1):void Layer.confirmNotByTextAlert({header:"财务拒绝",width:400,height:260,botByText:"填写拒绝提现的理由",title:"已勾选了 <b class='mainColor'>"+e.idList.length+"</b> 位人员，请填写拒绝提现的理由"},function(a){$.AJAX({url:config.basePath+"bankDeposit/reject",data:{idList:e.idList.toString(),checkRemark:a,handlerType:2},success:function(a){e.idList=[],Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList()}})}):(Layer.alert({width:300,height:150,type:"msg",title:"请选择需要操作的数据！",header:"财务拒绝"}),!1)},t.theCashier=function(){return e.idList.length?isFinaConfirm({datas:t.datas,idList:e.idList,id:"id",check:"checkStatus",val:[0]})?(Layer.alert({width:300,height:150,type:"msg",title:"请先进行财务确认！"}),!1):isFinaConfirm({datas:t.datas,idList:e.idList,id:"id",check:"checkStatus",val:[4,5]})?(Layer.alert({width:300,height:150,type:"msg",title:"已经提交到银行处理！"}),!1):void Layer.confirm({width:300,height:170,title:"已选择 <strong class='mainColor'>"+e.idList.length+"</strong> 条提现申请,是否<br>确认转账?",header:"出纳转账"},function(){win.showLoading(),$.AJAX({url:config.basePath+"bankDeposit/tellerTransfer",timeout:2e4,data:{idList:e.idList.toString()},success:function(a){win.hideLoading(),e.idList=[],Layer.miss({width:250,height:90,title:"提交银行成功",closeMask:!0}),t.getDataList()}})}):(Layer.alert({width:300,height:150,type:"msg",title:"请选择需要操作的数据！",header:"出纳转账"}),!1)},t.success=function(){return e.idList.length?isFinaConfirm({datas:t.datas,idList:e.idList,id:"id",check:"checkStatus",val:[0]})?(Layer.alert({width:300,height:150,type:"msg",title:"请先进行财务确认！"}),!1):isFinaConfirm({datas:t.datas,idList:e.idList,id:"id",check:"checkStatus",val:[4]})?(Layer.alert({width:300,height:150,type:"msg",title:"当前状态不可操作！"}),!1):void Layer.confirm({width:300,height:170,title:"已选择 <strong class='mainColor'>"+e.idList.length+"</strong> 条提现申请,是否<br>确认提现成功?",header:"提现成功"},function(){$.AJAX({url:config.basePath+"bankDeposit/pass",data:{idList:e.idList.toString()},success:function(a){e.idList=[],Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList()}})}):(Layer.alert({width:300,height:150,type:"msg",title:"请选择需要操作的数据！",header:"提现成功"}),!1)},t.error=function(){if(!e.idList.length)return Layer.alert({width:300,height:150,type:"msg",title:"请选择需要操作的数据！",header:"提现失败"}),!1;if(isFinaConfirm({datas:t.datas,idList:e.idList,id:"id",check:"checkStatus",val:[0]}))return Layer.alert({width:300,height:150,type:"msg",title:"请先进行财务确认！"}),!1;if(isFinaConfirm({datas:t.datas,idList:e.idList,id:"id",check:"checkStatus",val:[4]}))return Layer.alert({width:300,height:150,type:"msg",title:"当前状态不可操作！"}),!1;var a='<div class="custom-msg-but">					<textarea class="form-control" id="withdraw-remark" rows="3" placeholder="请填写备注(可为空)"></textarea>					<div><button type="button" onclick=Layer.closeNowLayer("customHtmlMask"); class="btn btn-sm btn-default">取消</button>					<button type="button" onclick="submitBeiZmsg()" class="btn btn-sm btn-primary">确定</button></div>				</div>';Layer.customHtml({header:"提现失败!",width:350,height:200,html:a})},window.submitBeiZmsg=function(){var a=$("#withdraw-remark").val();Layer.closeNowLayer("customHtmlMask"),$.AJAX({url:config.basePath+"bankDeposit/reject",data:{idList:e.idList.toString(),checkRemark:a,handlerType:1},success:function(a){e.idList=[],Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList()}})},t.downloadType=null,t.downLoadTxt=function(){window.location.href=config.basePath+"bankDeposit/downLoad?startTime="+t.startTime+"&endTime="+t.endTime+"&status="+t.status+"&"+t.searchType+"="+t.search},t.downloadType=null,t.downLoadExcel=function(){window.location.href=config.basePath+"bankDeposit/downLoadExcel?startTime="+t.startTime+"&endTime="+t.endTime+"&status="+t.status+"&"+t.searchType+"="+t.search}}]);