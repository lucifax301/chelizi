var app=angular.module("app",["ngFilter"]);app.controller("School",["$scope","$filter",function(t,a,e){function i(a){var e={url:config.basePath+"school/querySchool",data:{pageNo:a,pageSize:parseInt(t.pageSize),cityId:t.cityId,name:t.name}};return e}function o(a){var e={schoolNo:t.editData.schoolId,name:t.editData.name,cityId:parseInt(t.editData.cityId),address:t.editData.address,phoneNum:t.editData.phoneNum};return"edit"==t.editType&&angular.extend(e,{schoolId:t.editData.schoolId}),{url:config.basePath+a,data:e}}t.defaultPage=location.hash.substring(2)||1,t.pageSize=10,t.name="",t.checkSchoolSameName=0,t.getDataList=function(){var a=i(t.defaultPage);$.AJAX({type:"get",url:a.url,data:a.data,success:function(a){var e=getListData(a);t.datas=e.dataList,t.$apply(),new Page({parent:$("#copot-page"),nowPage:t.defaultPage,pageSize:t.pageSize,totalCount:e.total})}})},t.getDataList(),window.onhashchange=function(){win.showLoading(),t.defaultPage=location.hash.substring(2)||1,t.getDataList()},$.AJAX({type:"get",url:config.basePath+"school/queryCity",data:{rlevel:2,pid:""},success:function(a){t.citys=JSON.parse(a.result.pageData)}}),t.getDataForCity=function(){win.showLoading(),t.defaultPage=1,t.cityId=$("#getDataForCitySel").val(),t.getDataList()},t.getDataForPage=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},t.getDataForSearch=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},t.schoolEditLoad=function(){$(".closeAlert").click(function(){$(this).parents("div.school-alert").fadeOut("fast")})},t.editData={},t.editType="add",t.schoolEdit=function(a,e){$(".school-alert").fadeIn("fast"),$("#edit-content").css("marginTop",parseInt(($(win).height()-$("#edit-content").height()-100)/2)+"px"),"edit"==a?(t.editData=e,t.editType="edit"):(t.editData={},t.editType="add")},t.submitEditMsg=function(a){function e(a,e){$.AJAX({url:config.basePath+e,type:"get",async:!1,data:a,timeout:1e6,success:function(a){var e=JSON.parse(a.result.pageData).dataList;e.length>0&&"add"==t.editType&&(t.checkSchoolSameName=1),e.length>1&&"edit"==t.editType&&(alert("编辑，多项同名直接阻止"),t.checkSchoolSameName=1),(e.length="edit"==t.editType&&e[0].schoolId&&e[0].schoolId!=t.editData.schoolId)&&(t.checkSchoolSameName=1)}})}t.checkSchoolSameName=0;var i=o("add"==t.editType?"school/add":"school/update");return t.editData.name&&regCombination("*").test(t.editData.name)?t.editData.cityId?(e({name:t.editData.name},"school/querySchool"),t.checkSchoolSameName>0?(Layer.alert({width:300,height:150,type:"msg",title:"该驾校已存在"}),!1):void $.AJAX({url:i.url,data:i.data,type:"get",success:function(e){$(a.target).parents("div.school-alert").fadeOut("fast"),t.getDataList()}})):(Layer.alert({width:300,height:150,type:"msg",title:"请选择驾校城市"}),!1):(Layer.alert({width:300,height:150,type:"msg",title:"请填写驾校名称"}),!1)}}]);