var app=angular.module("app",["ngFilter","ngSelects"]);app.controller("Student",["$scope","$rootScope","$timeout","$filter","Selects",function(t,e,a,i,s){function n(e){var a={url:config.basePath+"student/cer-batch",data:{pageNo:e,pageSize:parseInt(t.pageSize),startTime:t.startTime,endTime:t.endTime,state:t.carState,phoneNum:t.phoneNum}};return a}t.defaultPage=location.hash.substring(2)||1,t.pageSize=10,t.startTime="",t.endTime="",t.phoneNum="",t.carState="",t.data={pages:10,total:100,pageSize:10,pageNo:1,dataList:[{id:0,studentName:"丁宇",studentIDNumber:"422802198910116575",authName:"小丁",state:0,operateUser:"喱喱"},{id:1,studentName:"丁宇",studentIDNumber:"422802198910116575",authName:"小丁",state:1,operateUser:"喱喱"},{id:2,studentName:"丁宇",studentIDNumber:"422802198910116575",authName:"小丁",state:2,operateUser:"喱喱"},{id:3,studentName:"丁宇",studentIDNumber:"422802198910116575",authName:"小丁",state:3,operateUser:"喱喱"},{id:4,studentName:"丁宇",studentIDNumber:"422802198910116575",authName:"小丁",state:4,operateUser:"喱喱"},{id:5,studentName:"丁宇",studentIDNumber:"422802198910116575",authName:"小丁",state:5,operateUser:"喱喱"}]},t.datas=t.data.dataList,s.selects({datas:t.datas,whichId:"id",trem:{check:"state",list:[0,1,3]}}),t.getDataList=function(){var e=n(t.defaultPage);$.AJAX({type:"get",url:e.url,data:e.data,success:function(e){var a=getListData(e);t.datas=a.dataList,s.selects({datas:t.datas,whichId:"id",trem:{check:"state",list:[0,1,3]}}),t.$apply(),new Page({parent:$("#copot-page"),nowPage:t.defaultPage,pageSize:t.pageSize,totalCount:a.total})}})},t.getDataList(),window.onhashchange=function(){win.showLoading(),t.defaultPage=location.hash.substring(2)||1,t.getDataList()},t.getDataForTime=function(e,a){switch($(e.target).addClass("active").siblings().removeClass("active"),a){case"all":t.startTime=t.endTime="";break;case"0":t.startTime=i("date")((new Date).getTime()-6048e5,"yyyy-MM-dd"),t.endTime=i("date")((new Date).getTime(),"yyyy-MM-dd");break;case"1":t.startTime=i("date")((new Date).getTime()-1296e6,"yyyy-MM-dd"),t.endTime=i("date")((new Date).getTime(),"yyyy-MM-dd")}t.defaultPage=1,win.showLoading(),t.getDataList()},$("#reservation").daterangepicker({format:"YYYY/MM/DD"},function(e,a,s){t.startTime=t.endTime="",t.startTime=i("date")(e.toISOString(),"yyyy-MM-dd"),t.endTime=i("date")(a.toISOString(),"yyyy-MM-dd"),t.defaultPage=1,win.showLoading(),t.getDataList(),t.$apply()}),t.getDataForCarType=function(e,a){$(e.target).addClass("active").siblings().removeClass("active"),win.showLoading(),t.carState=a,t.defaultPage=1,t.checkAllTag.carState=$(e.target).text(),t.objElement.carState=$(e.target),t.getDataList()},t.getDataForPage=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},t.getDataForSearch=function(e){win.showLoading(),t.defaultPage=1,t.checkAllTag.phoneNum=t.phoneNum,t.objElement.phoneNum=$(e.target),t.getDataList()},t.checkAllTag={},t.objElement={},t.removeTag=function(e){t.defaultPage=1,win.showLoading(),t.checkAllTag=deleteJson(t.checkAllTag,e),t.objElement[e]&&("LI"==t.objElement[e][0].nodeName?t.objElement[e].parent().children().eq(0).addClass("active").siblings().removeClass("active"):"children"==$(t.objElement[e][0]).attr("data-chr")&&(t.objElement[e].parent().removeClass("active"),t.objElement[e].parent().hide().children().removeClass("active"),t.objElement[e].parents("ul").find("div.tab-par").removeClass("active"),t.objElement[e].parents("ul").children().eq(0).children().addClass("active"))),t[e]="",t.getDataList()},t.removeAllTag=function(){jQuery.isEmptyObject(t.objElement)||(t.defaultPage=1,win.showLoading(),t.carState="",clearAllActive(t.objElement),t.checkAllTag={},t.objElement={},$("div.tab-line ul").find(".tab-par").removeClass("active"),$("div.tab-line ul").find("li").eq(0).children("div").addClass("active"),$("div.tab-chr").hide().children("div").removeClass("active"),t.getDataList())},t.notByIdentity=function(){return e.idList.length?isFinaConfirm({datas:t.datas,idList:e.idList,id:"id",check:"state",val:[2,3]})?(Layer.alert({width:350,height:170,type:"msg",title:"你要处理的认证申请里有已认证<br>或认证失败的申请，不能逆操作"}),!1):void Layer.confirmNotByTextAlert({header:"不通过",width:380,height:250,title:"您已选择<b class='error'>"+e.idList.length+"</b>条认证申请，是否全部确认不通过?"},function(a){$.AJAX({url:config.basePath+"student/update-auth",data:{state:3,ids:e.idList.toString(),remark:a,type:0},success:function(a){e.idList=[],Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList()}})}):(Layer.alert({width:300,height:150,type:"msg",title:"请选择需要处理的认证申请！"}),!1)},t.successIdentity=function(){return e.idList.length?isFinaConfirm({datas:t.datas,idList:e.idList,id:"id",check:"state",val:[2,3]})?(Layer.alert({width:350,height:170,type:"msg",title:"你要处理的认证申请里有已认证<br>或认证失败的申请，不能重复操作"}),!1):void Layer.confirmTextAlert({header:"通过",width:350,height:180,title:"您已选择<b class='error'>"+e.idList.length+"</b>条认证申请，是否全部确认通过?"},function(){$.AJAX({url:config.basePath+"student/update-auth",data:{state:2,ids:e.idList.toString(),type:0},success:function(a){e.idList=[],Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList()}})}):(Layer.alert({width:300,height:150,type:"msg",title:"请选择需要处理的认证申请！"}),!1)},t.revokeIdentity=function(){return e.idList.length?isFinaConfirm({datas:t.datas,idList:e.idList,id:"id",check:"state",val:[0,1]})?(Layer.alert({width:350,height:170,type:"msg",title:"你要处理的认证申请里未审核<br>的申请，不能操作"}),!1):void Layer.confirmTextAlert({header:"通过",width:350,height:180,title:"您已选择<b class='error'>"+e.idList.length+"</b>条认证申请，是否全部确认吊销?"},function(){$.AJAX({url:config.basePath+"student/update-auth",data:{state:5,ids:e.idList.toString(),type:0},success:function(a){e.idList=[],Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList()}})}):(Layer.alert({width:300,height:150,type:"msg",title:"请选择需要处理的认证申请！"}),!1)};var d=null;t.identityAccreditainImg=function(e,a){clearTimeout(d),d=setTimeout(function(){$.AJAX({type:"get",url:config.basePath+"student/img",data:{studentId:a},success:function(a){t.imgData=JSON.parse(a.result.vo),$("#w-identity-bg").css({left:e.pageX-338+"px",top:e.pageY-310+"px"}),t.isshow=!0,t.$apply()}})},500)},t.clearidentityAccImg=function(){t.isshow=!1,clearTimeout(d)}}]);