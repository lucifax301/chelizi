var app=angular.module("app",["ngFilter","ngSelects"]);app.controller("SchoolPurse",["$scope","$rootScope","$filter","Selects",function(t,e,a,i){function s(e){var a={url:config.basePath+"school/queryBurse",data:{pageNo:e,pageSize:parseInt(t.pageSize),cityId:t.cityId,startTime:t.startTime,endTime:t.endTime,sign:t.sign,checkStatus:t.checkStatus}};return a}t.defaultPage=location.hash.substring(2)||1,t.pageSize=10,t.startTime="",t.endTime="",t.sign="",t.checkStatus="",i.selects({datas:t.datas,whichId:"id"}),t.getDataList=function(){var e=s(t.defaultPage);$.AJAX({type:"get",url:e.url,data:e.data,success:function(e){var a=getListData(e);t.datas=a.dataList,i.selects({datas:t.datas,whichId:"id"}),t.$apply(),topLongText(),new Page({parent:$("#copot-page"),nowPage:t.defaultPage,pageSize:t.pageSize,totalCount:a.total})}})},t.getDataList(),window.onhashchange=function(){win.showLoading(),t.defaultPage=location.hash.substring(2)||1,t.getDataList()},t.getDataForTime=function(e,i){switch($(e.target).addClass("active").siblings().removeClass("active"),i){case"all":t.startTime=t.endTime="";break;case"0":t.startTime=a("date")((new Date).getTime()-6048e5,"yyyy-MM-dd"),t.endTime=a("date")((new Date).getTime(),"yyyy-MM-dd");break;case"1":t.startTime=a("date")((new Date).getTime()-1296e6,"yyyy-MM-dd"),t.endTime=a("date")((new Date).getTime(),"yyyy-MM-dd")}t.defaultPage=1,win.showLoading(),t.getDataList()},$("#reservation").daterangepicker({format:"YYYY/MM/DD"},function(e,i,s){t.startTime=t.endTime="",t.startTime=a("date")(e.toISOString(),"yyyy-MM-dd"),t.endTime=a("date")(i.toISOString(),"yyyy-MM-dd"),t.defaultPage=1,win.showLoading(),t.getDataList(),t.$apply()}),t.signType=function(e,a){$(e.target).addClass("active").siblings().removeClass("active"),win.showLoading(),t.defaultPage=1,t.sign=a,t.getDataList()},t.checkStatusType=function(e,a){$(e.target).addClass("active").siblings().removeClass("active"),win.showLoading(),t.defaultPage=1,t.checkStatus=a,t.getDataList()},t.getDataForPage=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},t.getDataForSearch=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},t.checkPass=function(){if(!e.idList.length)return Layer.alert({width:300,height:150,type:"msg",title:"请选择需要操作的数据！",header:"审核通过"}),!1;for(var a=getDataForKey({datas:t.datas,id:"id",idList:e.idList}),i=0;i<a.length;i++){if(1!=a[i].sign)return Layer.alert({width:300,height:150,type:"msg",title:"您只能审核‘开通钱包’的申请",header:"审核通过"}),!1;if($.inArray(a[i].checkStatus,[1,3])<0)return Layer.alert({width:300,height:170,type:"msg",title:"您只能操作未处理或<br>不通过的申请！",header:"审核通过"}),!1}Layer.confirm({width:300,height:170,title:"已选择 <strong class='mainColor'>"+e.idList.length+"</strong> 开通申请,是否<br>确认审核通过?",header:"确认通过"},function(){$.AJAX({url:config.basePath+"school/checkPass",data:{idList:e.idList.toString(),schoolNos:getKeyArrFromData(a,"schoolId").toString()},success:function(a){e.idList=[],Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList()}})})},t.checkReject=function(){if(!e.idList.length)return Layer.alert({width:300,height:150,type:"msg",title:"请选择需要操作的数据！",header:"审核不通过"}),!1;for(var a=getDataForKey({datas:t.datas,id:"id",idList:e.idList}),i=0;i<a.length;i++){if(1!=a[i].sign)return Layer.alert({width:300,height:150,type:"msg",title:"您只能审核‘开通钱包’的申请",header:"审核不通过"}),!1;if($.inArray(a[i].checkStatus,[1,3])<0)return Layer.alert({width:300,height:170,type:"msg",title:"您只能操作未处理或<br>不通过的申请！",header:"审核不通过"}),!1}Layer.confirmNotByTextAlert({header:"审核不过",width:400,height:260,botByText:"请填写理由",title:"请确认不通过所选驾校开通钱包的申请"},function(i){$.AJAX({url:config.basePath+"school/checkReject",data:{idList:e.idList.toString(),checkRemark:i,schoolNos:getKeyArrFromData(a,"schoolId").toString()},success:function(a){e.idList=[],Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList()}})})},t.agreeChange=function(){if(!e.idList.length)return Layer.alert({width:300,height:150,type:"msg",title:"请选择需要操作的数据！",header:"同意变更"}),!1;for(var a=getDataForKey({datas:t.datas,id:"id",idList:e.idList}),i=0;i<a.length;i++){if(2!=a[i].sign)return Layer.alert({width:300,height:150,type:"msg",title:"您只能同意‘变更资料’的申请",header:"同意变更"}),!1;if($.inArray(a[i].checkStatus,[1,5])<0)return Layer.alert({width:300,height:170,type:"msg",title:"您只能同意未处理或<br>已拒绝的申请！",header:"同意变更"}),!1}Layer.confirm({width:300,height:170,title:"已选择 <strong class='mainColor'>"+e.idList.length+"</strong> 变更申请,是否<br>确认同意变更?",header:"确认同意"},function(){$.AJAX({url:config.basePath+"school/agreeChange",data:{idList:e.idList.toString(),schoolNos:getKeyArrFromData(a,"schoolId").toString()},success:function(a){e.idList=[],Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList()}})})},t.refuseChange=function(){if(!e.idList.length)return Layer.alert({width:300,height:150,type:"msg",title:"请选择需要操作的数据！",header:"拒绝变更"}),!1;for(var a=getDataForKey({datas:t.datas,id:"id",idList:e.idList}),i=0;i<a.length;i++){if(parseInt(1!=a[i].sign))return Layer.alert({width:300,height:150,type:"msg",title:"您只能拒绝‘资料变更’的申请",header:"拒绝变更"}),!1;if($.inArray(a[i].checkStatus,[1,5])<0)return Layer.alert({width:300,height:170,type:"msg",title:"您只能拒绝未处理或<br>已拒绝的申请！",header:"拒绝变更"}),!1}Layer.confirmNotByTextAlert({header:"拒绝变更",width:400,height:260,botByText:"请填写理由",title:"请确认拒绝所选驾校变更资料的申请"},function(i){$.AJAX({url:config.basePath+"school/refuseChange",data:{idList:e.idList.toString(),checkRemark:i,schoolNos:getKeyArrFromData(a,"schoolId").toString()},success:function(a){e.idList=[],Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList()}})})}}]);