var app=angular.module("app",["ngFilter","ngSelects"]);app.controller("Coach",["$scope","$rootScope","$filter","Selects",function(t,a,e,i){function o(a){var e={url:config.basePath+"coach/batch",data:{pageNo:a,pageSize:parseInt(t.pageSize),accountStatus:t.accountStatus,schoolNo:t.schoolNo}};return e.data[t.searchType]=t.search,e}function c(a){var e={phoneNum:t.editData.phoneNum,sex:parseInt(t.editData.sex),idNumber:t.editData.idNumber,name:t.editData.name};return"edit"==t.editType&&angular.extend(e,{coachId:t.editData.coachId}),{url:config.basePath+a,data:e}}t.defaultPage=location.hash.substring(2)||1,t.pageSize=10,t.accountStatus=null,t.search="",t.searchType="name",t.schoolNo="",t.data={pages:10,total:100,pageSize:10,pageNo:1,dataList:[{coachId:101,name:"张教练",sex:0,phoneNum:"13476002586",applyCarType:0,coach:"张教练",idNumber:"422802198910116575",drivingSchool:"深港",accountStatus:0}]},t.datas=t.data.dataList,t.getDataList=function(){var a=o(t.defaultPage);$.AJAX({type:"get",url:a.url,data:a.data,success:function(a){var e=getListData(a);t.total=e.total,t.datas=e.dataList,i.selects({datas:t.datas,whichId:"coachId",num:""}),t.$apply(),new Page({parent:$("#copot-page"),nowPage:t.defaultPage,pageSize:t.pageSize,totalCount:e.total})}})},t.getDataList(),window.onhashchange=function(){win.showLoading(),t.defaultPage=location.hash.substring(2)||1,t.getDataList()},$.AJAX({type:"get",url:config.basePath+"school/query",success:function(a){t.schools=JSON.parse(a.result.pageData),t.$apply()}}),t.getDataForSchool=function(){win.showLoading(),t.defaultPage=1,t.schoolNo=t.schoolNo,t.getDataList()},t.getDataForAccountStatus=function(a,e){$(a.target).addClass("active").siblings().removeClass("active"),win.showLoading(),t.defaultPage=1,t.accountStatus=e,t.getDataList()},t.getDataForPage=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},t.getDataForSearch=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},t.coachDataExport=function(){dataExportForIframe({getSearchs:o(t.defaultPage).data,total:t.total,url:"coach/export-excel"})},t.coachEditLoad=function(){$(".closeAlert").click(function(){$(this).parents("div.edit-coach").fadeOut("fast")}),$("#birthday").daterangepicker({startDate:new Date,parentElement:$("#edit-coach"),singleDatePicker:!0},function(a,i,o){t.editData.birthday=e("date")(a.toISOString(),"yyyy-MM-dd")})},t.editData={},t.editType="add",t.coachEdit=function(a,e){$(".edit-coach").fadeIn("fast"),$("#edit-coach").css("marginTop",parseInt(($(win).height()-$("#edit-coach").height()-100)/2)+"px"),"edit"==a?(t.editData=e,t.editType="edit"):(t.editData={},t.editType="add")},t.submitEditMsg=function(a){var e=c("add"==t.editType?"coach/add":"coach/update");return t.editData.phoneNum.length<11||!regCombination("*").test(t.editData.phoneNum)?(Layer.alert({width:300,height:150,type:"msg",title:"请填写手机正确的号码"}),!1):void $.AJAX({url:e.url,data:e.data,success:function(e){$(a.target).parents("div.edit-coach").fadeOut("fast"),Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList()}})},t.closeAlert=function(){t.getDataList()},t.coachLockEditLoad=function(){$(".closeAlert").click(function(){$(this).parents("div.coach-lock-alert").fadeOut("fast")}),$("#reservation").daterangepicker({format:"YYYY-MM-DD",singleDatePicker:!0,autoclose:!0,timePicker:!0,timePicker24Hour:!0,timePickerSeconds:!0,autoApply:!0})},t.editData.state=1,t.lockTimeShow=function(a){$(".coach-lock-edit-time").slideDown("fast"),t.editData.state=$(a.target).val()},t.lockTimeHidden=function(a){$(".coach-lock-edit-time").slideUp("fast"),t.editData.state=$(a.target).val()},t.dataLock=function(){return a.idList.length?($(".coach-lock-alert").fadeIn("fast"),$("#edit-content").css("marginTop",parseInt(($(win).height()-$("#edit-content").height()-100)/2)+"px"),void(t.submitCoachLock=function(){if(!t.editData.note)return Layer.alert({width:300,height:150,type:"error",title:"请填写封号/解封理由"}),!1;var e="",i="";switch(parseInt(t.editData.state)){case 0:e="确定将此教练帐号解封？",i="被封号";break;case 1:e="确定将此教练帐号临时封号？",i="正常";break;case 2:e="确定将此教练帐号永久封号？",i="正常"}for(var o=getDataForKey({datas:t.datas,id:"coachId",idList:a.idList}),c=!0,n=0;n<o.length;n++)if(t.editData.state==o[n].state){c=!1;break}return c?void Layer.confirm({width:300,height:160,title:e,header:"教练封号"},function(){$.AJAX({url:config.basePath+"coach/lock-batch",data:{ids:a.idList.toString(),state:t.editData.state,reviveTime:t.editData.reviveTime,note:t.editData.note},type:"post",success:function(a){Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList(),$("div.coach-lock-alert").fadeOut("fast")}})}):(Layer.alert({width:430,height:175,type:"msg",title:"您只能选择状态相同的、状态"+i+"的教练，<br>请重新选择教练！"}),!1)})):(Layer.alert({width:300,height:150,type:"msg",title:"请选择要封号的教练！",header:"教练封号"}),!1)}}]);