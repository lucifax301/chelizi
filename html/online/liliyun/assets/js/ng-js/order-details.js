var app=angular.module("app",["ngFilter"]);app.controller("OrderDetails",["$scope","$rootScope","$filter",function(e,t,a){function r(t){switch(t){case 0:e.getOrderDetailsData();break;case 1:e.getOrderLogs()}}function d(t){var a={url:config.basePath+"logCommon/batch",data:{pageNo:t,pageSize:10,menuId:3,relateId:e.orderId}};return a}e.defaultPage=location.hash.substring(2)||1,e.orderId=getQueryString("orderId"),e.pageSize=10,e.index=0,e.refundsSum="",e.refundsRemark="",e.paytotal="",e.tableSwitch=function(t){e.index=tabPageDetails(t),win.showLoading(),location.hash="##1",r(e.index)},window.onhashchange=function(){win.showLoading(),e.defaultPage=location.hash.substring(2)||1,r(e.index)},e.getOrderDetailsData=function(){$.AJAX({type:"get",url:config.basePath+"order/view",data:{orderId:e.orderId},success:function(t){e.data=JSON.parse(t.result.order),e.paytotal=e.data.payTotal/100,e.datastu=JSON.parse(t.result.stuComment),e.datacoach=JSON.parse(t.result.coachComment),scoreHtml(1,"#zjzw"),scoreHtml(1,"#pddd"),scoreHtml(2,"#dcrk"),scoreHtml(3,"#qxxs"),scoreHtml(4,"#cbtc"),scoreHtml(5,"#zhpf"),e.$apply()}})},e.getOrderDetailsData(),e.closeOrder=function(){Layer.confirm({width:300,height:160,title:"确认关闭选中的订单吗？",header:"关闭订单"},function(){$.AJAX({url:config.basePath+"order/update-batch",data:{orderIds:e.orderId,studentIds:e.data.studentId,coachIds:e.data.coachId},success:function(t){Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),e.getOrderDetailsData()}})})},e.applyRefunds=function(){$(".closeAlert").click(function(){$(this).parents("div.data-refunds").fadeOut("fast")})},e.refunds=function(){$(".data-refunds").fadeIn("fast"),$("#refunds-alert").css("marginTop",parseInt(($(win).height()-$("#refunds-alert").height()-100)/2)+"px"),e.submitRefundsMsg=function(t){return regCombination("*").test(e.refundsSum)?e.refundsSum>=e.paytotal?(Layer.alert({width:300,height:150,type:"msg",title:"退款金额必须小于实付金额！",header:"申请退款"}),!1):e.refundsSum<0?(Layer.alert({width:300,height:150,type:"msg",title:"退款金额不能为负数！",header:"申请退款"}),!1):regCombination("number").test(e.refundsSum)?regCombination("*").test(e.refundsRemark)?void $.AJAX({url:config.basePath+"order/refund",data:{orderId:e.orderId,refundMoney:e.refundsSum,remark:e.refundsRemark},success:function(a){$(t.target).parents("div.data-refunds").fadeOut("fast"),Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),e.getOrderDetailsData()}}):(Layer.alert({width:300,height:150,type:"msg",title:"请填写退款理由！",header:"申请退款"}),!1):(Layer.alert({width:300,height:150,type:"msg",title:"退款金额请填写数字格式！",header:"申请退款"}),!1):(Layer.alert({width:300,height:150,type:"msg",title:"请填写退款金额！",header:"申请退款"}),!1)}},e.getOrderLogs=function(){var t=d(e.defaultPage);$.AJAX({type:"get",url:t.url,data:t.data,success:function(t){var a=getListData(t);e.orderLogs=a.dataList,e.$apply(),new Page({parent:$("#log-page"),nowPage:e.defaultPage,pageSize:e.pageSize,totalCount:a.total})}})}}]);