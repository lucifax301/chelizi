var app=angular.module("app",["ngFilter","ngSelects"]);app.controller("bankCard",["$scope","$rootScope","$filter","Selects",function(t,a,e,i){function s(a){var e={url:config.basePath+"boundBankCard/query",data:{pageNo:a,pageSize:parseInt(t.pageSize),startTime:t.startTime,endTime:t.endTime,status:t.status,name:t.name}};return e}t.defaultPage=location.hash.substring(2)||1,t.pageSize=10,t.startTime="",t.endTime="",t.status="",t.name="",t.getWithdrawCashData=function(){var a=s(t.defaultPage);$.AJAX({type:"get",url:a.url,data:a.data,success:function(a){var e=getListData(a);t.datas=e.dataList,i.selects({datas:t.datas,whichId:"id",num:""}),t.$apply(),new Page({parent:$("#copot-page"),nowPage:t.defaultPage,pageSize:t.pageSize,totalCount:e.total})}})},t.getWithdrawCashData(),window.onhashchange=function(){win.showLoading(),t.defaultPage=location.hash.substring(2)||1,t.getWithdrawCashData()},t.getDataForTime=function(a,i){switch($(a.target).addClass("active").siblings().removeClass("active"),i){case"all":t.startTime=t.endTime="";break;case"0":t.startTime=e("date")((new Date).getTime()-6048e5,"yyyy-MM-dd"),t.endTime=e("date")((new Date).getTime(),"yyyy-MM-dd");break;case"1":t.startTime=e("date")((new Date).getTime()-1296e6,"yyyy-MM-dd"),t.endTime=e("date")((new Date).getTime(),"yyyy-MM-dd")}win.showLoading(),t.defaultPage=1,t.getWithdrawCashData()},$("#reservation").daterangepicker({format:"YYYY/MM/DD"},function(a,i,s){t.startTime=t.endTime="",t.startTime=e("date")(a.toISOString(),"yyyy-MM-dd"),t.endTime=e("date")(i.toISOString(),"yyyy-MM-dd"),win.showLoading(),t.defaultPage=1,t.getWithdrawCashData(),t.$apply()}),t.getDataForState=function(a,e){$(a.target).addClass("active").siblings().removeClass("active"),win.showLoading(),t.defaultPage=1,t.status=e,t.getWithdrawCashData()},t.getDataForPage=function(){win.showLoading(),t.defaultPage=1,t.getWithdrawCashData()},t.getDataForSearch=function(){win.showLoading(),t.defaultPage=1,t.getWithdrawCashData()},t.success=function(){if(!a.idList.length)return Layer.alert({width:300,height:150,type:"msg",title:"请选择需要标示的数据！",header:"银行卡有效"}),!1;var e=getDataForKey({datas:t.datas,id:"id",idList:a.idList});Layer.confirm({width:300,height:160,title:"确认银行卡有效吗？",header:"银行卡有效"},function(){$.AJAX({url:config.basePath+"boundBankCard/pass",data:{idList:a.idList.join(),statusList:getKeyArrFromData(e,"status").toString()},success:function(e){a.idList=[],Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getWithdrawCashData()}})})},t.error=function(){return a.idList.length?void Layer.confirmNotByTextAlert({header:"银行卡无效",width:380,height:250,title:"您已选择<b class='error'>"+a.idList.length+"</b>张银行卡，是否全部确认无效?"},function(e){var i=getDataForKey({datas:t.datas,id:"id",idList:a.idList});$.AJAX({url:config.basePath+"boundBankCard/reject",data:{idList:a.idList.join(),statusList:getKeyArrFromData(i,"status").toString(),remark:e},success:function(e){a.idList=[],Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getWithdrawCashData()}})}):(Layer.alert({width:300,height:150,type:"msg",title:"请选择需要标示的数据！",header:"银行卡无效"}),!1)},t.downloadType=null,t.downLoadTxt=function(){window.location.href=config.basePath+"boundBankCard/downLoad?startTime="+t.startTime+"&endTime="+t.endTime+"&status="+t.status+"&name="+t.name},t.downloadType=null,t.downLoadExcel=function(){window.location.href=config.basePath+"boundBankCard/downLoadExcel?startTime="+t.startTime+"&endTime="+t.endTime+"&status="+t.status+"&name="+t.name}}]);