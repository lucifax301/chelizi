var app=angular.module("app",["ngFilter","ngSelects"]);app.controller("Student",["$scope","$rootScope","$filter","Selects",function(t,e,a,i){function s(e){var a={url:config.basePath+"field/batch",data:{pageNo:e,pageSize:parseInt(t.pageSize),name:t.name,schoolNo:t.schoolNo,region:t.cityId}};return a}function d(e){var a={name:t.editData.name,reverseLim:parseInt(t.editData.reverseLim),phoneNum:t.editData.phoneNum,posDesc:t.editData.posDesc,schoolId:t.editData.schoolId};return"edit"==t.editType&&angular.extend(a,{fieldId:t.editData.fieldId}),{url:config.basePath+e,data:a}}t.defaultPage=location.hash.substring(2)||1,t.pageSize=10,t.name="",t.schoolNo="",t.cityId="",t.data={pages:10,total:100,pageSize:10,pageNo:1,dataList:[{fieldId:201,name:"深圳港",reverseLim:"1000",phoneNum:"13476225415",posDesc:"这里面是深圳港的介绍"}]},i.selects({datas:t.datas,whichId:"fieldId"}),t.datas=t.data.dataList,t.getDataList=function(){var e=s(t.defaultPage);$.AJAX({type:"get",url:e.url,data:e.data,success:function(e){var a=getListData(e);t.total=a.total,t.datas=a.dataList,i.selects({datas:t.datas,whichId:"fieldId"}),t.$apply(),new Page({parent:$("#copot-page"),nowPage:t.defaultPage,pageSize:t.pageSize,totalCount:a.total})}})},t.getDataList(),window.onhashchange=function(){win.showLoading(),t.defaultPage=location.hash.substring(2)||1,t.getDataList()},$.AJAX({type:"get",url:config.basePath+"school/query",success:function(e){t.schools=JSON.parse(e.result.pageData),t.$apply()}}),t.getDataForCity=function(){win.showLoading(),t.defaultPage=1,t.cityId=t.cityId,t.getDataList()},t.getDataForSchool=function(){win.showLoading(),t.defaultPage=1,t.schoolNo=t.schoolNo,t.getDataList()},t.getDataForPage=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},t.getDataForSearch=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},t.fieldDataExport=function(){dataExportForIframe({getSearchs:s(t.defaultPage).data,total:t.total,url:"field/export-excel"})},t.fieldDisconnected=function(){for(var a=getDataForKey({datas:t.datas,id:"fieldId",idList:e.idList}),i=!0,s=0;s<a.length;s++)if(1!=a[s].isdel){i=!1;break}return e.idList.length?0==i?(Layer.alert({width:300,height:150,type:"msg",title:"您只能选择'已停用'的状态！",header:"激活启用"}),!1):void Layer.confirm({width:315,height:160,title:"您确认激活启用该训练场？",header:"激活启用"},function(){$.AJAX({url:config.basePath+"field/isDel",data:{idList:e.idList.toString(),isDel:0},success:function(e){Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList()}})}):(Layer.alert({width:300,height:150,type:"msg",title:"请选择'已停用'的状态！",header:"激活启用"}),!1)},t.fieldMaintenance=function(){for(var a=getDataForKey({datas:t.datas,id:"fieldId",idList:e.idList}),i=!0,s=0;s<a.length;s++)if(0!=a[s].isdel){i=!1;break}return e.idList.length?0==i?(Layer.alert({width:300,height:150,type:"msg",title:"您只能选择'启用中'的状态！",header:"停用维护"}),!1):void Layer.confirm({width:315,height:160,title:"您确认停用维护该训练场？",header:"停用维护"},function(){$.AJAX({url:config.basePath+"field/isDel",data:{idList:e.idList.toString(),isDel:1},success:function(e){Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList()}})}):(Layer.alert({width:300,height:150,type:"msg",title:"请选择'启用中'的状态！",header:"停用维护"}),!1)},t.siteEditLoad=function(){$(".closeAlert").click(function(){$(this).parents("div.edit-alert").fadeOut("fast")})},t.editData={},t.editType="add",t.siteEdit=function(e,a){$(".edit-alert").fadeIn("fast"),$("#edit-content").css("marginTop",parseInt(($(win).height()-$("#edit-content").height()-100)/2)+"px"),"edit"==e?(t.editData=a,t.editType="edit"):(t.editData={},t.editType="add")},queryCity({callback:function(e){t.citys=e,t.$apply()}}),t.getSchools=function(e){t.cityId=e,t.cityId?(t.checkHaveCity(),$("#select-school li").last().addClass("active").siblings().removeClass("active"),querySchool({cityId:t.cityId,callback:function(e){t.schools=e,t.$apply()}})):($("#select-school li").first().addClass("active").siblings().removeClass("active"),t.schoolNo="",t.schools="")},t.checkHaveCity=function(){t.cityError=!t.cityId},t.getSchoolId=function(e){t.editData.schoolId=e},t.submitEditMsg=function(e){var a=d("add"==t.editType?"field/add":"field/update");return t.editData.name&&regCombination("*").test(t.editData.name)?t.editData.reverseLim&&regCombination("number").test(t.editData.reverseLim)?t.editData.phoneNum&&regCombination("phone").test(t.editData.phoneNum)?t.editData.schoolId&&regCombination("*").test(t.editData.schoolId)?t.editData.posDesc&&regCombination("*").test(t.editData.posDesc)?void $.AJAX({url:a.url,data:a.data,success:function(a){$(e.target).parents("div.edit-alert").fadeOut("fast"),Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList()}}):(Layer.alert({width:300,height:150,type:"msg",title:"请填写地理位置"}),!1):(Layer.alert({width:300,height:150,type:"msg",title:"请选择驾校"}),!1):(Layer.alert({width:300,height:150,type:"msg",title:"请填写正确的联系电话"}),!1):(Layer.alert({width:300,height:150,type:"msg",title:"请填写正确的面积范围"}),!1):(Layer.alert({width:300,height:150,type:"msg",title:"请填写场地名"}),!1)},t.closeAlert=function(){t.getDataList()}}]);