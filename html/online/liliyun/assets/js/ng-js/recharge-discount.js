var app=angular.module("app",["ngFilter","ngSelects"]);app.controller("Recharge",["$scope","$rootScope","$filter","Selects",function(t,e,a,i){function s(e){var a={type:"get",url:config.basePath+"vip/record-batch",data:{pageNo:e,pageSize:parseInt(t.pageSize),startTime:t.startTime,endTime:t.endTime,vstate:t.vstate,vtype:t.vtype,utype:t.utype}};return a.data[t.searchType]=t.search,a}t.defaultPage=location.hash.substring(2)||1,t.pageSize=10,t.startTime="",t.endTime="",t.vtype="",t.phoneNum="",t.vstate="",t.utype=1,t.searchType="mobile",t.search="",t.verifyType="",i.selects({datas:t.datas,whichId:"rrid"}),t.getDataList=function(){var e=s(t.defaultPage);$.AJAX({type:"get",url:e.url,data:e.data,success:function(e){var a=getListData(e);t.total=a.total,t.datas=a.dataList,i.selects({datas:t.datas,whichId:"rrid"}),t.$apply(),topLongText(),new Page({parent:$("#copot-page"),nowPage:t.defaultPage,pageSize:t.pageSize,totalCount:a.total})}})},t.getDataList(),window.onhashchange=function(){win.showLoading(),t.defaultPage=location.hash.substring(2)||1,t.getDataList()},t.getDataForTime=function(e,i){switch($(e.target).addClass("active").siblings().removeClass("active"),i){case"all":t.startTime=t.endTime="";break;case"0":t.startTime=a("date")((new Date).getTime()-6048e5,"yyyy-MM-dd HH:mm:ss"),t.endTime=a("date")((new Date).getTime(),"yyyy-MM-dd HH:mm:ss");break;case"1":t.startTime=a("date")((new Date).getTime()-1296e6,"yyyy-MM-dd HH:mm:ss"),t.endTime=a("date")((new Date).getTime(),"yyyy-MM-dd HH:mm:ss")}t.defaultPage=1,win.showLoading(),t.getDataList()},$("#reservation").daterangepicker({format:"YYYY/MM/DD"},function(e,i,s){t.startTime=t.endTime="",t.startTime=a("date")(e.toISOString(),"yyyy-MM-dd HH:mm:ss"),t.endTime=a("date")(i.toISOString(),"yyyy-MM-dd HH:mm:ss"),t.defaultPage=1,win.showLoading(),t.getDataList(),t.$apply()}),t.getDataForUserType=function(e,a){$(e.target).addClass("active").siblings().removeClass("active"),win.showLoading(),t.defaultPage=1,t.vtype=a,t.getDataList()},t.getDataForvState=function(e,a){$(e.target).addClass("active").siblings().removeClass("active"),win.showLoading(),t.defaultPage=1,t.vstate=a,t.getDataList()},t.getDataForPage=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},t.getDataForSearch=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},$("#search_type").change(function(){$("#search_placeholder").attr("placeholder","输入"+$(this).children("option:selected").text()+"查询")}),t.rdStateEditLoad=function(){$(".closeAlert").click(function(){$(this).parents("div.recharge-discount-state").fadeOut("fast")})},t.actionInfo={msgWords:"",msgUrl:"",msgCode:[]},t.verifyAction=function(a){if(t.verifyType=a,t.alertText="","vPass"==a&&(t.actionInfo.msgWords="审核通过",t.actionInfo.msgUrl="vip/pass-record",t.actionInfo.msgCode=0,t.actionInfo.msgWords2="未审核"),"vFail"==a&&(t.actionInfo.msgWords="审核不通过",t.actionInfo.msgUrl="vip/refuse-record",t.actionInfo.msgCode=0,t.actionInfo.msgWords2="未审核"),!e.idList.length)return Layer.alert({width:325,height:160,type:"msg",title:"请选择需要"+t.actionInfo.msgWords+"的券模板！"}),!1;getDataForKey({datas:t.datas,id:"rcid",idList:e.idList});$(".recharge-discount-state").fadeIn("fast"),$("#edit-content").css("marginTop",parseInt(($(win).height()-$("#edit-content").height()-100)/2)+"px")},t.submitRDState=function(){return"vFail"!=t.verifyType||$("#vFailReason").val()?void $.AJAX({url:config.basePath+t.actionInfo.msgUrl,data:{rcids:e.idList.toString(),reason:"vFail"==t.verifyType?$("#vFailReason").val():""},success:function(e){Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),$(".recharge-discount-state").fadeOut(),t.getDataList()}}):(Layer.alert({width:325,height:160,type:"msg",title:"请输入审核不通过理由"}),!1)}}]);