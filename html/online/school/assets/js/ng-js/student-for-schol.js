var app=angular.module("app",["ngFilter","ngSelects"]);app.controller("Student",["$scope","$rootScope","$filter","Selects",function(t,e,a,s){function n(e){var a={url:config.basePath+"student/jx-batch",data:{pageNo:e,pageSize:parseInt(t.pageSize),applyCarType:t.carType,schoolId:t.schoolNo,applyexam:t.applystateTotal.split(",")[0],applystate:t.applystateTotal.split(",")[1],type:1}};return a.data[t.searchType]=t.search,a}function i(e){var a={phoneNum:t.editData.phoneNum,sex:parseInt(t.editData.sex),applyCarType:parseInt(t.editData.applyCarType),idNumber:t.editData.idNumber,name:t.editData.name};return"edit"==t.editType&&angular.extend(a,{studentId:t.editData.studentId}),{url:config.basePath+e,data:a}}t.defaultPage=location.hash.substring(2)||1,t.pageSize=10,t.carType="",t.search="",t.searchType="name",t.schoolNo="",t.applystateTotal="",t.getDataList=function(){var e=n(t.defaultPage);$.AJAX({type:"get",url:e.url,data:e.data,success:function(e){var a=getListData(e);t.total=a.total,t.datas=a.dataList,s.selects({datas:t.datas,whichId:"studentId"}),t.$apply(),new Page({parent:$("#copot-page"),nowPage:t.defaultPage,pageSize:t.pageSize,totalCount:a.total})}})},t.getDataList(),window.onhashchange=function(){win.showLoading(),t.defaultPage=location.hash.substring(2)||1,t.getDataList()},t.getDataForCarType=function(e,a){$(e.target).addClass("active").siblings().removeClass("active"),win.showLoading(),t.defaultPage=1,t.carType=a,t.checkAllTag.carType=$(e.target).text(),t.objElement.carType=$(e.target),t.getDataList()},t.studentStatesList=studentStatesListForSchool,t.comSearTabCheck=function(e,a){var s="DIV"==e.target.nodeName?$(e.target):$(e.target).parent("div");$("div.tab-par").removeClass("active"),$("div.tab-chr").hide(),s.addClass("active").next("div").show(),$("div.tab-par").find("span").attr("class","ion-arrow-up-b"),s.find("span").attr("class","ion-arrow-down-b"),"all"==a&&(t.defaultPage=1,t.getDataForStudentState(e,""))},t.getDataForStudentState=function(e,a){$(e.target).addClass("active").siblings().removeClass("active"),win.showLoading(),t.applystateTotal=a,t.defaultPage=1,t.checkAllTag.applystateTotal=$(e.target).text(),t.objElement.applystateTotal=$(e.target),t.getDataList()},t.getDataForPage=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},t.getDataForSearch=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},t.studentDataExport=function(){var e=n(t.defaultPage).data,a=jsonToGetUrl(e);t.total>config.explTotal?Layer.confirm({width:300,height:160,title:config.explPrompt,header:"导出"},function(){window.location.href=config.basePath+"student/export-excel?"+a}):window.location.href=config.basePath+"student/export-excel?"+a},t.checkAllTag={},t.objElement={},t.removeTag=function(e){win.showLoading(),t.checkAllTag=deleteJson(t.checkAllTag,e),t.objElement[e]&&("LI"==t.objElement[e][0].nodeName?t.objElement[e].parent().children().eq(0).addClass("active").siblings().removeClass("active"):"children"==$(t.objElement[e][0]).attr("data-chr")&&(t.objElement[e].parent().hide().children().removeClass("active"),t.objElement[e].parents("ul").find("div.tab-par").removeClass("active"),t.objElement[e].parents("ul").children().eq(0).children().addClass("active"))),t[e]="",t.getDataList()},t.removeAllTag=function(){jQuery.isEmptyObject(t.objElement)||(win.showLoading(),t.carType="",t.schoolNo="",t.applystateTotal="",clearAllActive(t.objElement),t.checkAllTag={},t.objElement={},$("div.tab-line ul").find(".tab-par").removeClass("active"),$("div.tab-line ul").find("li").eq(0).children("div").addClass("active"),$("div.tab-chr").hide().children("div").removeClass("active"),t.getDataList())},t.uploadSerialnumber=function(){cerateFileFormData({url:config.basePath+"student/uploadWater",data:{type:1},code:!0,callback:function(e){Layer.alertMor({width:450,height:220,type:"success",title:e.msg,callback:function(){$.AJAX({url:config.basePath+"student/uploadWater",data:{tagFileName:e.tagFileName,type:2},success:function(e){Layer.closeNowLayer("alertMorMask"),Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList()}})},close:function(){$.AJAX({url:config.basePath+"student/uploadWater",data:{tagFileName:e.tagFileName,type:3},success:function(){}})}})}})},t.sutdentEditLoad=function(){$(".closeAlert").click(function(){$(this).parents("div.edit-alert").fadeOut("fast")})},t.editData={},t.editType="add",t.studentEdit=function(e,a){$(".student-alert").fadeIn("fast"),$("#student-alert").css("marginTop",parseInt(($(win).height()-$("#student-alert").height()-100)/2)+"px"),"edit"==e?(t.editData=a,t.editType="edit"):(t.editData={},t.editType="add")},t.submitEditMsg=function(e){var a=i("add"==t.editType?"student/add":"student/update");return t.editData.phoneNum.length<11||!regCombination("*").test(t.editData.phoneNum)?(Layer.alert({width:300,height:160,type:"msg",title:"请填手机正确的号码"}),!1):void $.AJAX({url:a.url,data:a.data,success:function(a){$(e.target).parents("div.student-alert").fadeOut("fast"),Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList()}})},t.studentStates=[],t.haveStudentState=!1,t.incompleteData="",t.StudentStateLoad=function(){$(".closeAlert").click(function(){$(this).parents("div.student-state").fadeOut("fast")})},t.changeStudentState=function(){return t.studentStates=[],$("#studentState").val(""),e.idList.length?($(".student-state").fadeIn("fast"),$("#student-state").css("marginTop",parseInt(($(win).height()-$("#student-state").height()-100)/2)+"px"),void getDataForStudentConfig({datas:getDataForKey({datas:t.datas,idList:t.idList,id:"studentId"}),check:"applyexam,applystate",checkData:studentSchoolJurisConfig,callback:function(e){t.studentStates=e,t.haveStudentState=!!e.length,console.log(e)}})):(Layer.alert({width:300,height:150,type:"msg",title:"请选择需要置状态的学员！"}),!1)},t.changeErrorStudentLoad=function(){$(".closeAlert").click(function(){$(this).parents("div.change-error-students").fadeOut("fast")})},t.submitStudentState=function(a){var s=$("#studentState").val();return regCombination("*").test(s)?void $.AJAX({url:config.basePath+"student/reset-state",data:{applyexam:s.split(",")[0],applystate:s.split(",")[1],studentIds:e.idList.toString()},success:function(e){"fail"==e.status?($(".change-error-students").fadeIn("fast"),$("#change-error-students").css("marginTop","150px"),t.errDataList=studentStateRes(getListData(e)),console.log(getListData(e)),console.log(t.errDataList),t.$apply()):($(a.target).parents("div.student-state").fadeOut("fast"),Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList())}}):(Layer.alert({width:300,height:150,type:"msg",title:"请选择学员需要置的状态！"}),!1)},t.closeChanErrorStud=function(t){$(t.target).parents("div.change-error-students").fadeOut("fast")}}]);