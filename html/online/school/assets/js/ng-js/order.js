var app=angular.module("app",["ngFilter","ngSelects"]);app.controller("Order",["$scope","$rootScope","$filter","Selects",function(t,e,a,i,s){function r(e){var a={url:config.basePath+"order/batch",data:{pageNo:e,pageSize:parseInt(t.pageSize),startTime:t.startTime,endTime:t.endTime,subject:t.subject,payState:t.payState,orderState:t.orderState,applyCarType:t.carType,otype:t.otype}};return a.data[t.searchType]=t.search,a}t.defaultPage=location.hash.substring(2)||1,t.pageSize=10,t.startTime="",t.endTime="",t.subject="",t.orderId="",t.orderState="",t.payState="",t.searchType="orderId",t.otype="",t.search="",t.carType="",t.getDataList=function(){var e=r(t.defaultPage);$.AJAX({type:"get",url:e.url,data:e.data,success:function(e){var a=getListData(e);t.total=a.total,t.datas=a.dataList,i.selects({datas:t.datas,whichId:"orderId",num:""}),t.$apply(),topLongText(),new Page({parent:$("#copot-page"),nowPage:t.defaultPage,pageSize:t.pageSize,totalCount:a.total})}})},t.getDataList(),window.onhashchange=function(){win.showLoading(),t.defaultPage=location.hash.substring(2)||1,t.getDataList()},t.getDataForTime=function(e,i){switch($(e.target).addClass("active").siblings().removeClass("active"),i){case"all":t.startTime=t.endTime="";break;case"0":t.startTime=a("date")((new Date).getTime()-6048e5,"yyyy-MM-dd"),t.endTime=a("date")((new Date).getTime(),"yyyy-MM-dd");break;case"1":t.startTime=a("date")((new Date).getTime()-1296e6,"yyyy-MM-dd"),t.endTime=a("date")((new Date).getTime(),"yyyy-MM-dd")}win.showLoading(),t.defaultPage=1,t.getDataList()},$("#reservation").daterangepicker({format:"YYYY/MM/DD"},function(e,i,s){t.startTime=t.endTime="",t.startTime=a("date")(e.toISOString(),"yyyy-MM-dd"),t.endTime=a("date")(i.toISOString(),"yyyy-MM-dd"),win.showLoading(),t.defaultPage=1,t.getDataList(),t.$apply()}),t.getDataForCarType=function(e,a){$(e.target).addClass("active").siblings().removeClass("active"),win.showLoading(),t.defaultPage=1,t.carType=a,t.getDataList()},t.getDataForSubject=function(e,a){$(e.target).addClass("active").siblings().removeClass("active"),win.showLoading(),t.defaultPage=1,t.subject=a,t.getDataList()},t.getDataForPayment=function(e,a){$(e.target).addClass("active").siblings().removeClass("active"),win.showLoading(),t.defaultPage=1,t.payState=a,t.getDataList()},t.getOrderState=function(e,a){$(e.target).addClass("active").siblings().removeClass("active"),win.showLoading(),t.defaultPage=1,t.orderState=a,t.getDataList()},t.getDataForOtype=function(e,a){$(e.target).addClass("active").siblings().removeClass("active"),win.showLoading(),t.defaultPage=1,t.otype=a,t.getDataList()},t.getDataForPage=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},t.getDataForSearch=function(){win.showLoading(),t.defaultPage=1,t.getDataList()},t.closeOrder=function(){if(!e.idList.length)return Layer.alert({width:300,height:150,type:"msg",title:"请选择需要关闭的订单！"}),!1;var a=getDataForKey({datas:t.datas,id:"orderId",idList:e.idList});Layer.confirm({width:300,height:160,title:"确认关闭选中的订单吗？",header:"关闭订单"},function(){$.AJAX({url:config.basePath+"order/update-batch",data:{orderIds:e.idList.toString(),studentIds:getKeyArrFromData(a,"studentId").toString(),coachIds:getKeyArrFromData(a,"coachId").toString()},success:function(a){e.idList=[],Layer.miss({width:250,height:90,title:"操作成功",closeMask:!0}),t.getDataList()}})})},t.orderDataExport=function(){dataExportForIframe({getSearchs:r(t.defaultPage).data,total:t.total,url:"order/export-excel"})}}]);