var app=angular.module("app",["ngSelects"]);app.controller("SetPassword",["$scope","getMsgTime",function(s,o){o.getNowTime("getpassword"),s.schoolId=getQueryString("schoolId"),s.mobile=getQueryString("mobile"),s.captcha="",s.isCaptcha="",s.password="",s.ispassword="",s.confirmPassword="",s.isconfirmPassword="",s.obtainCode="",s.isobtainCode="",s.oldpassword="",s.isoldpassword="",s.newpassword="",s.isnewPassword="",s.newconfirmPassword="",s.isnewconfirmPassword="",s.passwordName="",s.accountText="","update"==getQueryString("type")?(s.updatePassword=!0,s.passwordName="修改支付密码"):(s.findPassword=!0,s.passwordName="找回支付密码"),$.AJAX({type:"get",url:config.basePath+"school/queryAccount",data:{schoolId:s.schoolId},success:function(o){s.schoolDetails=JSON.parse(o.result.pageData),s.$apply()}}),s.SetPassword=function(){return regCombination("number",[5,6]).test(s.captcha)?(s.iscaptcha=0,regCombination("*",[8,16]).test(s.password)?(s.ispassword=0,s.confirmPassword!=s.password?(s.isconfirmPassword="两次密码输入不一致",!1):(s.isconfirmPassword=0,void $.AJAX({url:config.basePath+"school/queryPasswd",data:{mobile:s.mobile,codeInput:s.captcha,passwd:s.password},success:function(o){s.findPassword=!1,s.accountText=!0,s.accountText="新密码设置成功，请牢记您的新密码",s.$apply()},error:function(o){s.iscaptcha=o.msg,s.$apply()}}))):(s.ispassword="请输入8-16位密码",!1)):(s.iscaptcha="请输入5-6位数字验证码",!1)},s.ObtainCode=function(){$.AJAX({type:"get",url:config.basePath+"authcodes/one",data:{mobile:s.mobile,userType:"5",reqType:"2",timestamp:time()},success:function(a){s.isobtainCode="验证码已经发送到绑定手机号，30分钟内有效，请注意查收！",o.shotMessage("getpassword",function(){s.isobtainCode=!1})}})},s.UpdatePassword=function(){return regCombination("*",[8,16]).test(s.oldpassword)?(s.isoldpassword=0,regCombination("*",[8,16]).test(s.newpassword)?(s.isnewpassword=0,s.newconfirmPassword!=s.newpassword?(s.isnewconfirmPassword="两次密码输入不一致",!1):(s.isnewconfirmPassword=0,void $.AJAX({url:config.basePath+"school/alertPasswd",data:{passwdOld:s.oldpassword,passwd:s.newpassword},success:function(o){s.updatePassword=!1,s.accountText=!0,s.accountText="支付密码修改成功，请保管好您的新密码",s.$apply()},error:function(o){s.isoldpassword=o.msg,s.$apply()}}))):(s.isnewpassword="请输入8-16位密码",!1)):(s.isoldpassword="请输入8-16位密码",!1)}}]);