var app=angular.module("app",["ngSelects"]);app.controller("ApplicationAccount",["$scope","getMsgTime",function(i,t){t.getNowTime(),i.schoolId=getQueryString("schoolId"),i.applicationName="申请驾校账户",i.posName="",i.isposName="",i.RegistrationNumber="",i.isRegistrationNumber="",i.Organizations="",i.isOrganizations="",i.TaxRegistration="",i.isTaxRegistration="",i.PublicAccount="",i.isPublicAccount="",i.BankDeposit="",i.isBankDeposit="",i.Branches="",i.isBranches="",i.password="",i.ispassword="",i.confirmPassword="",i.isconfirmPassword="",i.telphone="",i.istelphone="",i.obtainCode="",i.isobtainCode="",i.captcha="",i.isCaptcha="","change"==getQueryString("type")?(i.accountText=!1,i.applicationName="申请变更商户信息",i.title=!0,i.basicInformation=!0,i.dLoad=!1,i.ChangeBtn=!0,i.textHide=!0,$.AJAX({type:"get",url:config.basePath+"school/queryAccount",data:{schoolId:i.schoolId},success:function(t){i.schoolDetails=getListData(t),i.posName=i.schoolDetails.merName,i.RegistrationNumber=i.schoolDetails.registNo,i.Organizations=i.schoolDetails.orgCode,i.TaxRegistration=i.schoolDetails.taxId,i.PublicAccount=i.schoolDetails.publicAccount,i.BankDeposit=i.schoolDetails.bankName,i.Branches=i.schoolDetails.subBankName,i.$apply()}})):"audit"==getQueryString("type")?i.liliAudit=!0:"noPass"==getQueryString("type")?i.auditNotpass=!0:i.accountText=!0,i.opened=function(){i.title=!0,i.accountText=!1,i.basicInformation=!0,i.dLoad=!0,i.BasicBtn=!0},i.BasicInformation=function(){return regCombination("chinese",[0,1]).test(i.posName)?(i.isposName="输入字数有误",!1):regCombination("chinese",[2,30]).test(i.posName)?(i.isposName=0,regCombination("number",[0,14]).test(i.RegistrationNumber)?(i.isRegistrationNumber="输入字数有误",!1):regCombination("number",[15,15]).test(i.RegistrationNumber)?(i.isRegistrationNumber=0,regCombination("chinese",[6,20]).test(i.Organizations)||!regCombination("special",[6,20]).test(i.Organizations)?(i.isOrganizations="输入的长度或类型有误",!1):(i.isOrganizations=0,regCombination("chinese",[6,20]).test(i.TaxRegistration)||!regCombination("special",[6,20]).test(i.TaxRegistration)?(i.isTaxRegistration="输入的长度或类型有误",!1):(i.isTaxRegistration=0,regCombination("number",[0,5]).test(i.PublicAccount)?(i.isPublicAccount="输入字数有误",!1):regCombination("number",[6,20]).test(i.PublicAccount)?(i.isPublicAccount=0,regCombination("*").test(i.BankDeposit)?(i.isBankDeposit=0,regCombination("*").test(i.Branches)?regCombination("chinese",[1,30]).test(i.Branches)?(i.isBranches=0,i.basicInformation=!1,void(i.businessAccount=!0)):(i.isBranches="字符格式不对",!1):(i.isBranches="请选择开户支行",!1)):(i.isBankDeposit="请选择开户银行",!1)):(i.isPublicAccount="字符格式不对",!1)))):(i.isRegistrationNumber="字符格式不对",!1)):(i.isposName="字符格式不对",!1)},i.getDataBankDeposit=function(){$.AJAX({url:config.basePath+"authcodes/bankName",type:"get",data:{publicAccount:i.PublicAccount},success:function(t){i.BankDeposit=t.result.pageData,i.$apply()},error:function(t){i.isPublicAccount=t.msg,i.$apply()}})},i.BusinessAccount=function(){return regCombination("*",[0,7]).test(i.password)?(i.ispassword="输入字数有误",!1):regCombination("*",[8,16]).test(i.password)?(i.ispassword=0,i.confirmPassword!=i.password?(i.isconfirmPassword="两次密码输入不一致",!1):(i.isconfirmPassword=0,regCombination("*").test(i.telphone)?regCombination("phone").test(i.telphone)?(i.istelphone=0,regCombination("number",[5,6]).test(i.captcha)?(i.iscaptcha=0,void $.AJAX({url:config.basePath+"school/applyAccount",data:{merName:i.posName,type:1,registNo:i.RegistrationNumber,orgCode:i.Organizations,taxId:i.TaxRegistration,publicAccount:i.PublicAccount,bankName:i.BankDeposit,subBankName:i.Branches,mobile:i.telphone,passwd:i.password,codeInput:i.captcha},success:function(t){i.businessAccount=!1,i.liliAudit=!0,window.location.href="schools-account.html",i.$apply()},error:function(t){i.iscaptcha=t.msg,i.$apply()}})):(i.iscaptcha="请输入5-6位数字验证码",!1)):(i.istelphone="手机号格式错误",!1):(i.istelphone="请填写手机号",!1))):(i.ispassword="字符格式不对",!1)},i.ObtainCode=function(){return regCombination("*").test(i.telphone)?regCombination("phone").test(i.telphone)?(i.istelphone=0,void $.AJAX({type:"get",url:config.basePath+"authcodes/one",data:{mobile:i.telphone,userType:"5",reqType:"1",timestamp:time()},success:function(e){i.isobtainCode="验证码已经发送到绑定手机号，30分钟内有效，请注意查收！",t.shotMessage(function(){i.isobtainCode=!1})}})):(i.istelphone="手机号格式错误",!1):(i.istelphone="请填写手机号",!1)},i.ChangeInformation=function(){return $(".d-change-password .ng-valid").siblings("span").show(),regCombination("chinese",[0,1]).test(i.posName)?(i.isposName="输入字数有误",!1):regCombination("chinese",[2,30]).test(i.posName)?(i.isposName=0,regCombination("number",[0,14]).test(i.RegistrationNumber)?(i.isRegistrationNumber="输入字数有误",!1):regCombination("number",[15,15]).test(i.RegistrationNumber)?(i.isRegistrationNumber=0,regCombination("chinese",[6,20]).test(i.Organizations)||!regCombination("special",[6,20]).test(i.Organizations)?(i.isOrganizations="输入的长度或类型有误",!1):(i.isOrganizations=0,regCombination("chinese",[6,20]).test(i.TaxRegistration)||!regCombination("special",[6,20]).test(i.TaxRegistration)?(i.isTaxRegistration="输入的长度或类型有误",!1):(i.isTaxRegistration=0,regCombination("number",[0,5]).test(i.PublicAccount)?(i.isPublicAccount="输入字数有误",!1):regCombination("number",[6,20]).test(i.PublicAccount)?(i.isPublicAccount=0,regCombination("*").test(i.BankDeposit)?(i.isBankDeposit=0,regCombination("*").test(i.Branches)?regCombination("chinese",[1,30]).test(i.Branches)?(i.isBranches=0,void $.AJAX({url:config.basePath+"school/applyAccount",data:{merName:i.posName,type:2,registNo:i.RegistrationNumber,orgCode:i.Organizations,taxId:i.TaxRegistration,publicAccount:i.PublicAccount,bankName:i.BankDeposit,subBankName:i.Branches},success:function(t){i.businessAccount=!1,i.liliAudit=!0,window.location="schools-account.html",i.$apply()}})):(i.isBranches="字符格式不对",!1):(i.isBranches="请选择开户支行",!1)):(i.isBankDeposit="请选择开户银行",!1)):(i.isPublicAccount="字符格式不对",!1)))):(i.isRegistrationNumber="字符格式不对",!1)):(i.isposName="字符格式不对",!1)},$(".d-change-password").on("focus",".ng-valid",function(){$(this).siblings("span").hide()})}]);